<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - mochitest-e10s.info - gfx/skia/skia/src/gpu/GrDrawContext.cpp</title>
  <link rel="stylesheet" type="text/css" href="../../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../../index.html">top level</a> - <a href="index.html">gfx/skia/skia/src/gpu</a> - GrDrawContext.cpp<span style="font-size: 80%;"> (source / <a href="GrDrawContext.cpp.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">mochitest-e10s.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">590</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-04-21</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">47</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            :  * Copyright 2015 Google Inc.
<span class="lineNum">       3 </span>            :  *
<span class="lineNum">       4 </span>            :  * Use of this source code is governed by a BSD-style license that can be
<span class="lineNum">       5 </span>            :  * found in the LICENSE file.
<span class="lineNum">       6 </span>            :  */
<span class="lineNum">       7 </span>            : 
<span class="lineNum">       8 </span>            : #include &quot;GrBatchTest.h&quot;
<span class="lineNum">       9 </span>            : #include &quot;GrColor.h&quot;
<span class="lineNum">      10 </span>            : #include &quot;GrDrawContext.h&quot;
<span class="lineNum">      11 </span>            : #include &quot;GrDrawContextPriv.h&quot;
<span class="lineNum">      12 </span>            : #include &quot;GrDrawingManager.h&quot;
<span class="lineNum">      13 </span>            : #include &quot;GrFixedClip.h&quot;
<span class="lineNum">      14 </span>            : #include &quot;GrGpuResourcePriv.h&quot;
<span class="lineNum">      15 </span>            : #include &quot;GrOvalRenderer.h&quot;
<span class="lineNum">      16 </span>            : #include &quot;GrPathRenderer.h&quot;
<span class="lineNum">      17 </span>            : #include &quot;GrPipelineBuilder.h&quot;
<span class="lineNum">      18 </span>            : #include &quot;GrRenderTarget.h&quot;
<span class="lineNum">      19 </span>            : #include &quot;GrRenderTargetPriv.h&quot;
<span class="lineNum">      20 </span>            : #include &quot;GrResourceProvider.h&quot;
<span class="lineNum">      21 </span>            : #include &quot;SkSurfacePriv.h&quot;
<span class="lineNum">      22 </span>            : 
<span class="lineNum">      23 </span>            : #include &quot;batches/GrBatch.h&quot;
<span class="lineNum">      24 </span>            : #include &quot;batches/GrClearBatch.h&quot;
<span class="lineNum">      25 </span>            : #include &quot;batches/GrDrawAtlasBatch.h&quot;
<span class="lineNum">      26 </span>            : #include &quot;batches/GrDrawVerticesBatch.h&quot;
<span class="lineNum">      27 </span>            : #include &quot;batches/GrRectBatchFactory.h&quot;
<span class="lineNum">      28 </span>            : #include &quot;batches/GrNinePatch.h&quot; // TODO Factory
<span class="lineNum">      29 </span>            : #include &quot;batches/GrRegionBatch.h&quot;
<span class="lineNum">      30 </span>            : 
<span class="lineNum">      31 </span>            : #include &quot;effects/GrRRectEffect.h&quot;
<span class="lineNum">      32 </span>            : 
<span class="lineNum">      33 </span>            : #include &quot;instanced/InstancedRendering.h&quot;
<span class="lineNum">      34 </span>            : 
<span class="lineNum">      35 </span>            : #include &quot;text/GrAtlasTextContext.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;text/GrStencilAndCoverTextContext.h&quot;
<span class="lineNum">      37 </span>            : 
<span class="lineNum">      38 </span>            : #include &quot;../private/GrAuditTrail.h&quot;
<span class="lineNum">      39 </span>            : 
<span class="lineNum">      40 </span>            : #include &quot;SkGr.h&quot;
<span class="lineNum">      41 </span>            : #include &quot;SkLatticeIter.h&quot;
<span class="lineNum">      42 </span>            : #include &quot;SkMatrixPriv.h&quot;
<span class="lineNum">      43 </span>            : 
<span class="lineNum">      44 </span>            : #define ASSERT_OWNED_RESOURCE(R) SkASSERT(!(R) || (R)-&gt;getContext() == fDrawingManager-&gt;getContext())
<span class="lineNum">      45 </span>            : #define ASSERT_SINGLE_OWNER \
<span class="lineNum">      46 </span>            :     SkDEBUGCODE(GrSingleOwner::AutoEnforce debug_SingleOwner(fSingleOwner);)
<span class="lineNum">      47 </span>            : #define ASSERT_SINGLE_OWNER_PRIV \
<span class="lineNum">      48 </span>            :     SkDEBUGCODE(GrSingleOwner::AutoEnforce debug_SingleOwner(fDrawContext-&gt;fSingleOwner);)
<span class="lineNum">      49 </span>            : #define RETURN_IF_ABANDONED        if (fDrawingManager-&gt;wasAbandoned()) { return; }
<span class="lineNum">      50 </span>            : #define RETURN_IF_ABANDONED_PRIV   if (fDrawContext-&gt;fDrawingManager-&gt;wasAbandoned()) { return; }
<span class="lineNum">      51 </span>            : #define RETURN_FALSE_IF_ABANDONED  if (fDrawingManager-&gt;wasAbandoned()) { return false; }
<span class="lineNum">      52 </span>            : #define RETURN_FALSE_IF_ABANDONED_PRIV  if (fDrawContext-&gt;fDrawingManager-&gt;wasAbandoned()) { return false; }
<span class="lineNum">      53 </span>            : #define RETURN_NULL_IF_ABANDONED   if (fDrawingManager-&gt;wasAbandoned()) { return nullptr; }
<span class="lineNum">      54 </span>            : 
<span class="lineNum">      55 </span>            : using gr_instanced::InstancedRendering;
<span class="lineNum">      56 </span>            : 
<a name="57"><span class="lineNum">      57 </span>            : class AutoCheckFlush {</a>
<span class="lineNum">      58 </span>            : public:
<span class="lineNum">      59 </span><span class="lineNoCov">          0 :     AutoCheckFlush(GrDrawingManager* drawingManager) : fDrawingManager(drawingManager) {</span>
<a name="60"><span class="lineNum">      60 </span>            :         SkASSERT(fDrawingManager);</a>
<span class="lineNum">      61 </span>            :     }
<span class="lineNum">      62 </span><span class="lineNoCov">          0 :     ~AutoCheckFlush() { fDrawingManager-&gt;flushIfNecessary(); }</span>
<span class="lineNum">      63 </span>            : 
<span class="lineNum">      64 </span>            : private:
<span class="lineNum">      65 </span>            :     GrDrawingManager* fDrawingManager;
<a name="66"><span class="lineNum">      66 </span>            : };</a>
<span class="lineNum">      67 </span>            : 
<span class="lineNum">      68 </span><span class="lineNoCov">          0 : bool GrDrawContext::wasAbandoned() const {</span>
<span class="lineNum">      69 </span><span class="lineNoCov">          0 :     return fDrawingManager-&gt;wasAbandoned();</span>
<span class="lineNum">      70 </span>            : }
<span class="lineNum">      71 </span>            : 
<span class="lineNum">      72 </span>            : // In MDB mode the reffing of the 'getLastDrawTarget' call's result allows in-progress
<span class="lineNum">      73 </span>            : // drawTargets to be picked up and added to by drawContexts lower in the call
<span class="lineNum">      74 </span>            : // stack. When this occurs with a closed drawTarget, a new one will be allocated
<span class="lineNum">      75 </span>            : // when the drawContext attempts to use it (via getDrawTarget).
<span class="lineNum">      76 </span><span class="lineNoCov">          0 : GrDrawContext::GrDrawContext(GrContext* context,</span>
<span class="lineNum">      77 </span>            :                              GrDrawingManager* drawingMgr,
<span class="lineNum">      78 </span>            :                              sk_sp&lt;GrRenderTarget&gt; rt,
<span class="lineNum">      79 </span>            :                              sk_sp&lt;SkColorSpace&gt; colorSpace,
<span class="lineNum">      80 </span>            :                              const SkSurfaceProps* surfaceProps,
<span class="lineNum">      81 </span>            :                              GrAuditTrail* auditTrail,
<span class="lineNum">      82 </span>            :                              GrSingleOwner* singleOwner)
<span class="lineNum">      83 </span>            :     : fDrawingManager(drawingMgr)
<span class="lineNum">      84 </span>            :     , fRenderTarget(std::move(rt))
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :     , fDrawTarget(SkSafeRef(fRenderTarget-&gt;getLastDrawTarget()))</span>
<span class="lineNum">      86 </span>            :     , fContext(context)
<span class="lineNum">      87 </span><span class="lineNoCov">          0 :     , fInstancedPipelineInfo(fRenderTarget.get())</span>
<span class="lineNum">      88 </span>            :     , fColorSpace(std::move(colorSpace))
<span class="lineNum">      89 </span>            :     , fColorXformFromSRGB(nullptr)
<span class="lineNum">      90 </span>            :     , fSurfaceProps(SkSurfacePropsCopyOrDefault(surfaceProps))
<span class="lineNum">      91 </span><span class="lineNoCov">          0 :     , fAuditTrail(auditTrail)</span>
<span class="lineNum">      92 </span>            : #ifdef SK_DEBUG
<span class="lineNum">      93 </span>            :     , fSingleOwner(singleOwner)
<span class="lineNum">      94 </span>            : #endif
<span class="lineNum">      95 </span>            : {
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :     if (fColorSpace) {</span>
<span class="lineNum">      97 </span>            :         // sRGB sources are very common (SkColor, etc...), so we cache that gamut transformation
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :         auto srgbColorSpace = SkColorSpace::NewNamed(SkColorSpace::kSRGB_Named);</span>
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :         fColorXformFromSRGB = GrColorSpaceXform::Make(srgbColorSpace.get(), fColorSpace.get());</span>
<span class="lineNum">     100 </span>            :     }
<span class="lineNum">     101 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     102 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     103 </span>            : 
<span class="lineNum">     104 </span>            : #ifdef SK_DEBUG
<span class="lineNum">     105 </span>            : void GrDrawContext::validate() const {
<span class="lineNum">     106 </span>            :     SkASSERT(fRenderTarget);
<span class="lineNum">     107 </span>            :     ASSERT_OWNED_RESOURCE(fRenderTarget);
<span class="lineNum">     108 </span>            : 
<span class="lineNum">     109 </span>            :     if (fDrawTarget &amp;&amp; !fDrawTarget-&gt;isClosed()) {
<span class="lineNum">     110 </span>            :         SkASSERT(fRenderTarget-&gt;getLastDrawTarget() == fDrawTarget);
<span class="lineNum">     111 </span>            :     }
<span class="lineNum">     112 </span>            : }
<a name="113"><span class="lineNum">     113 </span>            : #endif</a>
<span class="lineNum">     114 </span>            : 
<span class="lineNum">     115 </span><span class="lineNoCov">          0 : GrDrawContext::~GrDrawContext() {</span>
<span class="lineNum">     116 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     117 </span><span class="lineNoCov">          0 :     SkSafeUnref(fDrawTarget);</span>
<span class="lineNum">     118 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     119 </span>            : 
<span class="lineNum">     120 </span><span class="lineNoCov">          0 : GrDrawTarget* GrDrawContext::getDrawTarget() {</span>
<span class="lineNum">     121 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     122 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     123 </span>            : 
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :     if (!fDrawTarget || fDrawTarget-&gt;isClosed()) {</span>
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :         fDrawTarget = fDrawingManager-&gt;newDrawTarget(fRenderTarget.get());</span>
<span class="lineNum">     126 </span>            :     }
<span class="lineNum">     127 </span>            : 
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :     return fDrawTarget;</span>
<span class="lineNum">     129 </span>            : }
<span class="lineNum">     130 </span>            : 
<span class="lineNum">     131 </span><span class="lineNoCov">          0 : bool GrDrawContext::copySurface(GrSurface* src, const SkIRect&amp; srcRect, const SkIPoint&amp; dstPoint) {</span>
<span class="lineNum">     132 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :     RETURN_FALSE_IF_ABANDONED</span>
<span class="lineNum">     134 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::copySurface&quot;);</span>
<span class="lineNum">     136 </span>            : 
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :     return this-&gt;getDrawTarget()-&gt;copySurface(fRenderTarget.get(), src, srcRect, dstPoint);</span>
<a name="138"><span class="lineNum">     138 </span>            : }</a>
<span class="lineNum">     139 </span>            : 
<span class="lineNum">     140 </span><span class="lineNoCov">          0 : void GrDrawContext::drawText(const GrClip&amp; clip, const GrPaint&amp; grPaint,</span>
<span class="lineNum">     141 </span>            :                              const SkPaint&amp; skPaint,
<span class="lineNum">     142 </span>            :                              const SkMatrix&amp; viewMatrix,
<span class="lineNum">     143 </span>            :                              const char text[], size_t byteLength,
<span class="lineNum">     144 </span>            :                              SkScalar x, SkScalar y, const SkIRect&amp; clipBounds) {
<span class="lineNum">     145 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     147 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawText&quot;);</span>
<span class="lineNum">     149 </span>            : 
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :     GrAtlasTextContext* atlasTextContext = fDrawingManager-&gt;getAtlasTextContext();</span>
<span class="lineNum">     151 </span>            :     atlasTextContext-&gt;drawText(fContext, this, clip, grPaint, skPaint, viewMatrix, fSurfaceProps,
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :                                text, byteLength, x, y, clipBounds);</span>
<a name="153"><span class="lineNum">     153 </span>            : }</a>
<span class="lineNum">     154 </span>            : 
<span class="lineNum">     155 </span><span class="lineNoCov">          0 : void GrDrawContext::drawPosText(const GrClip&amp; clip, const GrPaint&amp; grPaint,</span>
<span class="lineNum">     156 </span>            :                                 const SkPaint&amp; skPaint,
<span class="lineNum">     157 </span>            :                                 const SkMatrix&amp; viewMatrix,
<span class="lineNum">     158 </span>            :                                 const char text[], size_t byteLength,
<span class="lineNum">     159 </span>            :                                 const SkScalar pos[], int scalarsPerPosition,
<span class="lineNum">     160 </span>            :                                 const SkPoint&amp; offset, const SkIRect&amp; clipBounds) {
<span class="lineNum">     161 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     163 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawPosText&quot;);</span>
<span class="lineNum">     165 </span>            : 
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :     GrAtlasTextContext* atlasTextContext = fDrawingManager-&gt;getAtlasTextContext();</span>
<span class="lineNum">     167 </span>            :     atlasTextContext-&gt;drawPosText(fContext, this, clip, grPaint, skPaint, viewMatrix,
<span class="lineNum">     168 </span>            :                                   fSurfaceProps, text, byteLength, pos, scalarsPerPosition,
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :                                   offset, clipBounds);</span>
<span class="lineNum">     170 </span>            : 
<a name="171"><span class="lineNum">     171 </span>            : }</a>
<span class="lineNum">     172 </span>            : 
<span class="lineNum">     173 </span><span class="lineNoCov">          0 : void GrDrawContext::drawTextBlob(const GrClip&amp; clip, const SkPaint&amp; skPaint,</span>
<span class="lineNum">     174 </span>            :                                  const SkMatrix&amp; viewMatrix, const SkTextBlob* blob,
<span class="lineNum">     175 </span>            :                                  SkScalar x, SkScalar y,
<span class="lineNum">     176 </span>            :                                  SkDrawFilter* filter, const SkIRect&amp; clipBounds) {
<span class="lineNum">     177 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     179 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawTextBlob&quot;);</span>
<span class="lineNum">     181 </span>            : 
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :     GrAtlasTextContext* atlasTextContext = fDrawingManager-&gt;getAtlasTextContext();</span>
<span class="lineNum">     183 </span>            :     atlasTextContext-&gt;drawTextBlob(fContext, this, clip, skPaint, viewMatrix, fSurfaceProps, blob,
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :                                    x, y, filter, clipBounds);</span>
<span class="lineNum">     185 </span>            : }
<span class="lineNum">     186 </span>            : 
<span class="lineNum">     187 </span><span class="lineNoCov">          0 : void GrDrawContext::discard() {</span>
<span class="lineNum">     188 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     190 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::discard&quot;);</span>
<span class="lineNum">     192 </span>            : 
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :     this-&gt;getDrawTarget()-&gt;discard(fRenderTarget.get());</span>
<span class="lineNum">     195 </span>            : }
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span><span class="lineNoCov">          0 : void GrDrawContext::clear(const SkIRect* rect,</span>
<span class="lineNum">     198 </span>            :                           const GrColor color,
<span class="lineNum">     199 </span>            :                           bool canIgnoreRect) {
<span class="lineNum">     200 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     202 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::clear&quot;);</span>
<span class="lineNum">     204 </span>            : 
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :     this-&gt;internalClear(rect ? GrFixedClip(*rect) : GrFixedClip::Disabled(), color, canIgnoreRect);</span>
<span class="lineNum">     207 </span>            : }
<span class="lineNum">     208 </span>            : 
<span class="lineNum">     209 </span><span class="lineNoCov">          0 : void GrDrawContextPriv::clear(const GrFixedClip&amp; clip,</span>
<span class="lineNum">     210 </span>            :                               const GrColor color,
<span class="lineNum">     211 </span>            :                               bool canIgnoreClip) {
<span class="lineNum">     212 </span>            :     ASSERT_SINGLE_OWNER_PRIV
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED_PRIV</span>
<span class="lineNum">     214 </span>            :     SkDEBUGCODE(fDrawContext-&gt;validate();)
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fDrawContext-&gt;fAuditTrail, &quot;GrDrawContextPriv::clear&quot;);</span>
<span class="lineNum">     216 </span>            : 
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawContext-&gt;fDrawingManager);</span>
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :     fDrawContext-&gt;internalClear(clip, color, canIgnoreClip);</span>
<span class="lineNum">     219 </span>            : }
<span class="lineNum">     220 </span>            : 
<span class="lineNum">     221 </span><span class="lineNoCov">          0 : void GrDrawContext::internalClear(const GrFixedClip&amp; clip,</span>
<span class="lineNum">     222 </span>            :                                   const GrColor color,
<span class="lineNum">     223 </span>            :                                   bool canIgnoreClip) {
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :     bool isFull = false;</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :     if (!clip.hasWindowRectangles()) {</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :         isFull = !clip.scissorEnabled() ||</span>
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :                  (canIgnoreClip &amp;&amp; fContext-&gt;caps()-&gt;fullClearIsFree()) ||</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :                  clip.scissorRect().contains(SkIRect::MakeWH(this-&gt;width(), this-&gt;height()));</span>
<span class="lineNum">     229 </span>            :     }
<span class="lineNum">     230 </span>            : 
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :     if (fContext-&gt;caps()-&gt;useDrawInsteadOfClear()) {</span>
<span class="lineNum">     232 </span>            :         // This works around a driver bug with clear by drawing a rect instead.
<span class="lineNum">     233 </span>            :         // The driver will ignore a clear if it is the only thing rendered to a
<span class="lineNum">     234 </span>            :         // target before the target is read.
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :         SkRect clearRect = SkRect::MakeIWH(this-&gt;width(), this-&gt;height());</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :         if (isFull) {</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :             this-&gt;discard();</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :         } else if (!clearRect.intersect(SkRect::Make(clip.scissorRect()))) {</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     240 </span>            :         }
<span class="lineNum">     241 </span>            : 
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :         GrPaint paint;</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :         paint.setColor4f(GrColor4f::FromGrColor(color));</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :         paint.setXPFactory(GrPorterDuffXPFactory::Make(SkXfermode::Mode::kSrc_Mode));</span>
<span class="lineNum">     245 </span>            : 
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :         this-&gt;drawRect(clip, paint, SkMatrix::I(), clearRect);</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :     } else if (isFull) {</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :         this-&gt;getDrawTarget()-&gt;fullClear(this-&gt;accessRenderTarget(), color);</span>
<span class="lineNum">     249 </span>            :     } else {
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :         sk_sp&lt;GrBatch&gt; batch(GrClearBatch::Make(clip, color, this-&gt;accessRenderTarget()));</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :         if (!batch) {</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     253 </span>            :         }
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :         this-&gt;getDrawTarget()-&gt;addBatch(std::move(batch));</span>
<span class="lineNum">     255 </span>            :     }
<span class="lineNum">     256 </span>            : }
<span class="lineNum">     257 </span>            : 
<span class="lineNum">     258 </span><span class="lineNoCov">          0 : void GrDrawContext::drawPaint(const GrClip&amp; clip,</span>
<span class="lineNum">     259 </span>            :                               const GrPaint&amp; origPaint,
<span class="lineNum">     260 </span>            :                               const SkMatrix&amp; viewMatrix) {
<span class="lineNum">     261 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     263 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawPaint&quot;);</span>
<span class="lineNum">     265 </span>            : 
<span class="lineNum">     266 </span>            :     // set rect to be big enough to fill the space, but not super-huge, so we
<span class="lineNum">     267 </span>            :     // don't overflow fixed-point implementations
<span class="lineNum">     268 </span>            : 
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :     SkRect r = fRenderTarget-&gt;getBoundsRect();</span>
<span class="lineNum">     270 </span>            :     SkTCopyOnFirstWrite&lt;GrPaint&gt; paint(origPaint);
<span class="lineNum">     271 </span>            : 
<span class="lineNum">     272 </span>            :     SkRRect rrect;
<span class="lineNum">     273 </span>            :     bool aaRRect;
<span class="lineNum">     274 </span>            :     // Check if we can replace a clipRRect()/drawPaint() with a drawRRect(). We only do the
<span class="lineNum">     275 </span>            :     // transformation for non-rect rrects. Rects caused a performance regression on an Android
<span class="lineNum">     276 </span>            :     // test that needs investigation. We also skip cases where there are fragment processors
<span class="lineNum">     277 </span>            :     // because they may depend on having correct local coords and this path draws in device space
<span class="lineNum">     278 </span>            :     // without a local matrix.
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :     if (!paint-&gt;numTotalFragmentProcessors() &amp;&amp;</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :         clip.isRRect(r, &amp;rrect, &amp;aaRRect) &amp;&amp; !rrect.isRect()) {</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :         paint.writable()-&gt;setAntiAlias(aaRRect);</span>
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :         this-&gt;drawRRect(GrNoClip(), *paint, SkMatrix::I(), rrect, GrStyle::SimpleFill());</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     284 </span>            :     }
<span class="lineNum">     285 </span>            : 
<span class="lineNum">     286 </span>            :     // by definition this fills the entire clip, no need for AA
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :     if (paint-&gt;isAntiAlias()) {</span>
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :         paint.writable()-&gt;setAntiAlias(false);</span>
<span class="lineNum">     289 </span>            :     }
<span class="lineNum">     290 </span>            : 
<span class="lineNum">     291 </span><span class="lineNoCov">          0 :     bool isPerspective = viewMatrix.hasPerspective();</span>
<span class="lineNum">     292 </span>            : 
<span class="lineNum">     293 </span>            :     // We attempt to map r by the inverse matrix and draw that. mapRect will
<span class="lineNum">     294 </span>            :     // map the four corners and bound them with a new rect. This will not
<span class="lineNum">     295 </span>            :     // produce a correct result for some perspective matrices.
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :     if (!isPerspective) {</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :         if (!SkMatrixPriv::InverseMapRect(viewMatrix, &amp;r, r)) {</span>
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :             SkDebugf(&quot;Could not invert matrix\n&quot;);</span>
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     300 </span>            :         }
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :         this-&gt;drawRect(clip, *paint, viewMatrix, r);</span>
<span class="lineNum">     302 </span>            :     } else {
<span class="lineNum">     303 </span>            :         SkMatrix localMatrix;
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :         if (!viewMatrix.invert(&amp;localMatrix)) {</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :             SkDebugf(&quot;Could not invert matrix\n&quot;);</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     307 </span>            :         }
<span class="lineNum">     308 </span>            : 
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :         AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">     310 </span>            : 
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :         this-&gt;drawNonAAFilledRect(clip, *paint, SkMatrix::I(), r, nullptr, &amp;localMatrix, nullptr,</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :                                   false /* useHWAA */);</span>
<span class="lineNum">     313 </span>            :     }
<a name="314"><span class="lineNum">     314 </span>            : }</a>
<span class="lineNum">     315 </span>            : 
<span class="lineNum">     316 </span><span class="lineNoCov">          0 : static inline bool rect_contains_inclusive(const SkRect&amp; rect, const SkPoint&amp; point) {</span>
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :     return point.fX &gt;= rect.fLeft &amp;&amp; point.fX &lt;= rect.fRight &amp;&amp;</span>
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :            point.fY &gt;= rect.fTop &amp;&amp; point.fY &lt;= rect.fBottom;</span>
<a name="319"><span class="lineNum">     319 </span>            : }</a>
<span class="lineNum">     320 </span>            : 
<span class="lineNum">     321 </span><span class="lineNoCov">          0 : static bool view_matrix_ok_for_aa_fill_rect(const SkMatrix&amp; viewMatrix) {</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :     return viewMatrix.preservesRightAngles();</span>
<a name="323"><span class="lineNum">     323 </span>            : }</a>
<span class="lineNum">     324 </span>            : 
<span class="lineNum">     325 </span><span class="lineNoCov">          0 : static bool should_apply_coverage_aa(const GrPaint&amp; paint, GrRenderTarget* rt,</span>
<span class="lineNum">     326 </span>            :                                      bool* useHWAA = nullptr) {
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :     if (!paint.isAntiAlias()) {</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :         if (useHWAA) {</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :             *useHWAA = false;</span>
<span class="lineNum">     330 </span>            :         }
<span class="lineNum">     331 </span>            :         return false;
<span class="lineNum">     332 </span>            :     } else {
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :         if (useHWAA) {</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :             *useHWAA = rt-&gt;isUnifiedMultisampled();</span>
<span class="lineNum">     335 </span>            :         }
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :         return !rt-&gt;isUnifiedMultisampled();</span>
<span class="lineNum">     337 </span>            :     }
<span class="lineNum">     338 </span>            : }
<span class="lineNum">     339 </span>            : 
<a name="340"><span class="lineNum">     340 </span>            : // Attempts to crop a rect and optional local rect to the clip boundaries.</a>
<span class="lineNum">     341 </span>            : // Returns false if the draw can be skipped entirely.
<span class="lineNum">     342 </span><span class="lineNoCov">          0 : static bool crop_filled_rect(int width, int height, const GrClip&amp; clip,</span>
<span class="lineNum">     343 </span>            :                              const SkMatrix&amp; viewMatrix, SkRect* rect,
<span class="lineNum">     344 </span>            :                              SkRect* localRect = nullptr) {
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :     if (!viewMatrix.rectStaysRect()) {</span>
<span class="lineNum">     346 </span>            :         return true;
<span class="lineNum">     347 </span>            :     }
<span class="lineNum">     348 </span>            : 
<span class="lineNum">     349 </span>            :     SkIRect clipDevBounds;
<span class="lineNum">     350 </span>            :     SkRect clipBounds;
<span class="lineNum">     351 </span>            : 
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :     clip.getConservativeBounds(width, height, &amp;clipDevBounds);</span>
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :     if (!SkMatrixPriv::InverseMapRect(viewMatrix, &amp;clipBounds, SkRect::Make(clipDevBounds))) {</span>
<span class="lineNum">     354 </span>            :         return false;
<span class="lineNum">     355 </span>            :     }
<span class="lineNum">     356 </span>            : 
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :     if (localRect) {</span>
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :         if (!rect-&gt;intersects(clipBounds)) {</span>
<span class="lineNum">     359 </span>            :             return false;
<span class="lineNum">     360 </span>            :         }
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :         const SkScalar dx = localRect-&gt;width() / rect-&gt;width();</span>
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :         const SkScalar dy = localRect-&gt;height() / rect-&gt;height();</span>
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :         if (clipBounds.fLeft &gt; rect-&gt;fLeft) {</span>
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :             localRect-&gt;fLeft += (clipBounds.fLeft - rect-&gt;fLeft) * dx;</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :             rect-&gt;fLeft = clipBounds.fLeft;</span>
<span class="lineNum">     366 </span>            :         }
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :         if (clipBounds.fTop &gt; rect-&gt;fTop) {</span>
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :             localRect-&gt;fTop += (clipBounds.fTop - rect-&gt;fTop) * dy;</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :             rect-&gt;fTop = clipBounds.fTop;</span>
<span class="lineNum">     370 </span>            :         }
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :         if (clipBounds.fRight &lt; rect-&gt;fRight) {</span>
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :             localRect-&gt;fRight -= (rect-&gt;fRight - clipBounds.fRight) * dx;</span>
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :             rect-&gt;fRight = clipBounds.fRight;</span>
<span class="lineNum">     374 </span>            :         }
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :         if (clipBounds.fBottom &lt; rect-&gt;fBottom) {</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :             localRect-&gt;fBottom -= (rect-&gt;fBottom - clipBounds.fBottom) * dy;</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :             rect-&gt;fBottom = clipBounds.fBottom;</span>
<span class="lineNum">     378 </span>            :         }
<span class="lineNum">     379 </span>            :         return true;
<span class="lineNum">     380 </span>            :     }
<span class="lineNum">     381 </span>            : 
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :     return rect-&gt;intersect(clipBounds);</span>
<span class="lineNum">     383 </span>            : }
<span class="lineNum">     384 </span>            : 
<span class="lineNum">     385 </span><span class="lineNoCov">          0 : bool GrDrawContext::drawFilledRect(const GrClip&amp; clip,</span>
<span class="lineNum">     386 </span>            :                                    const GrPaint&amp; paint,
<span class="lineNum">     387 </span>            :                                    const SkMatrix&amp; viewMatrix,
<span class="lineNum">     388 </span>            :                                    const SkRect&amp; rect,
<span class="lineNum">     389 </span>            :                                    const GrUserStencilSettings* ss) {
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :     SkRect croppedRect = rect;</span>
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :     if (!crop_filled_rect(this-&gt;width(), this-&gt;height(), clip, viewMatrix, &amp;croppedRect)) {</span>
<span class="lineNum">     392 </span>            :         return true;
<span class="lineNum">     393 </span>            :     }
<span class="lineNum">     394 </span>            : 
<span class="lineNum">     395 </span>            :     SkAutoTUnref&lt;GrDrawBatch&gt; batch;
<span class="lineNum">     396 </span>            :     bool useHWAA;
<span class="lineNum">     397 </span>            : 
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :     if (GrCaps::InstancedSupport::kNone != fContext-&gt;caps()-&gt;instancedSupport()) {</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :         InstancedRendering* ir = this-&gt;getDrawTarget()-&gt;instancedRendering();</span>
<span class="lineNum">     400 </span>            :         batch.reset(ir-&gt;recordRect(croppedRect, viewMatrix, paint.getColor(),
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :                                    paint.isAntiAlias(), fInstancedPipelineInfo,</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :                                    &amp;useHWAA));</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :         if (batch) {</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :             GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :             if (ss) {</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :                 pipelineBuilder.setUserStencil(ss);</span>
<span class="lineNum">     407 </span>            :             }
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :             this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :             return true;</span>
<span class="lineNum">     410 </span>            :         }
<span class="lineNum">     411 </span>            :     }
<span class="lineNum">     412 </span>            : 
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :     if (should_apply_coverage_aa(paint, fRenderTarget.get(), &amp;useHWAA)) {</span>
<span class="lineNum">     414 </span>            :         // The fill path can handle rotation but not skew.
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :         if (view_matrix_ok_for_aa_fill_rect(viewMatrix)) {</span>
<span class="lineNum">     416 </span>            :             SkRect devBoundRect;
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :             viewMatrix.mapRect(&amp;devBoundRect, croppedRect);</span>
<span class="lineNum">     418 </span>            : 
<span class="lineNum">     419 </span>            :             batch.reset(GrRectBatchFactory::CreateAAFill(paint, viewMatrix, rect, croppedRect,
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :                                                          devBoundRect));</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :             if (batch) {</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :                 GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :                 if (ss) {</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :                     pipelineBuilder.setUserStencil(ss);</span>
<span class="lineNum">     425 </span>            :                 }
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :                 this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :                 return true;</span>
<span class="lineNum">     428 </span>            :             }
<span class="lineNum">     429 </span>            :         }
<span class="lineNum">     430 </span>            :     } else {
<span class="lineNum">     431 </span>            :         this-&gt;drawNonAAFilledRect(clip, paint, viewMatrix, croppedRect, nullptr, nullptr, ss,
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :                                   useHWAA);</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :         return true;</span>
<span class="lineNum">     434 </span>            :     }
<span class="lineNum">     435 </span>            : 
<span class="lineNum">     436 </span>            :     return false;
<span class="lineNum">     437 </span>            : }
<span class="lineNum">     438 </span>            : 
<span class="lineNum">     439 </span><span class="lineNoCov">          0 : void GrDrawContext::drawRect(const GrClip&amp; clip,</span>
<span class="lineNum">     440 </span>            :                              const GrPaint&amp; paint,
<span class="lineNum">     441 </span>            :                              const SkMatrix&amp; viewMatrix,
<span class="lineNum">     442 </span>            :                              const SkRect&amp; rect,
<span class="lineNum">     443 </span>            :                              const GrStyle* style) {
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :     if (!style) {</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :         style = &amp;GrStyle::SimpleFill();</span>
<span class="lineNum">     446 </span>            :     }
<span class="lineNum">     447 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     449 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawRect&quot;);</span>
<span class="lineNum">     451 </span>            : 
<span class="lineNum">     452 </span>            :     // Path effects should've been devolved to a path in SkGpuDevice
<span class="lineNum">     453 </span>            :     SkASSERT(!style-&gt;pathEffect());
<span class="lineNum">     454 </span>            : 
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">     456 </span>            : 
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :     const SkStrokeRec&amp; stroke = style-&gt;strokeRec();</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :     if (stroke.getStyle() == SkStrokeRec::kFill_Style) {</span>
<span class="lineNum">     459 </span>            :         
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :         if (!fContext-&gt;caps()-&gt;useDrawInsteadOfClear()) {</span>
<span class="lineNum">     461 </span>            :             // Check if this is a full RT draw and can be replaced with a clear. We don't bother
<span class="lineNum">     462 </span>            :             // checking cases where the RT is fully inside a stroke.
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :             SkRect rtRect = fRenderTarget-&gt;getBoundsRect();</span>
<span class="lineNum">     464 </span>            :             // Does the clip contain the entire RT?
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :             if (clip.quickContains(rtRect)) {</span>
<span class="lineNum">     466 </span>            :                 SkMatrix invM;
<span class="lineNum">     467 </span><span class="lineNoCov">          0 :                 if (!viewMatrix.invert(&amp;invM)) {</span>
<span class="lineNum">     468 </span><span class="lineNoCov">          0 :                     return;</span>
<span class="lineNum">     469 </span>            :                 }
<span class="lineNum">     470 </span>            :                 // Does the rect bound the RT?
<span class="lineNum">     471 </span>            :                 SkPoint srcSpaceRTQuad[4];
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :                 invM.mapRectToQuad(srcSpaceRTQuad, rtRect);</span>
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :                 if (rect_contains_inclusive(rect, srcSpaceRTQuad[0]) &amp;&amp;</span>
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :                     rect_contains_inclusive(rect, srcSpaceRTQuad[1]) &amp;&amp;</span>
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :                     rect_contains_inclusive(rect, srcSpaceRTQuad[2]) &amp;&amp;</span>
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :                     rect_contains_inclusive(rect, srcSpaceRTQuad[3])) {</span>
<span class="lineNum">     477 </span>            :                     // Will it blend?
<span class="lineNum">     478 </span>            :                     GrColor clearColor;
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :                     if (paint.isConstantBlendedColor(&amp;clearColor)) {</span>
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :                         this-&gt;clear(nullptr, clearColor, true);</span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">     482 </span>            :                     }
<span class="lineNum">     483 </span>            :                 }
<span class="lineNum">     484 </span>            :             }
<span class="lineNum">     485 </span>            :         }
<span class="lineNum">     486 </span>            : 
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :         if (this-&gt;drawFilledRect(clip, paint, viewMatrix, rect, nullptr)) {</span>
<span class="lineNum">     488 </span>            :             return;
<span class="lineNum">     489 </span>            :         }
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :     } else if (stroke.getStyle() == SkStrokeRec::kStroke_Style ||</span>
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :                stroke.getStyle() == SkStrokeRec::kHairline_Style) {</span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :         if ((!rect.width() || !rect.height()) &amp;&amp;</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :             SkStrokeRec::kHairline_Style != stroke.getStyle()) {</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :             SkScalar r = stroke.getWidth() / 2;</span>
<span class="lineNum">     495 </span>            :             // TODO: Move these stroke-&gt;fill fallbacks to GrShape?
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :             switch (stroke.getJoin()) {</span>
<span class="lineNum">     497 </span>            :                 case SkPaint::kMiter_Join:
<span class="lineNum">     498 </span>            :                     this-&gt;drawRect(clip, paint, viewMatrix,
<span class="lineNum">     499 </span><span class="lineNoCov">          0 :                                    {rect.fLeft - r, rect.fTop - r,</span>
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :                                     rect.fRight + r, rect.fBottom + r},</span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :                                    &amp;GrStyle::SimpleFill());</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :                     return;</span>
<span class="lineNum">     503 </span>            :                 case SkPaint::kRound_Join:
<span class="lineNum">     504 </span>            :                     // Raster draws nothing when both dimensions are empty.
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :                     if (rect.width() || rect.height()){</span>
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :                         SkRRect rrect = SkRRect::MakeRectXY(rect.makeOutset(r, r), r, r);</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :                         this-&gt;drawRRect(clip, paint, viewMatrix, rrect, GrStyle::SimpleFill());</span>
<span class="lineNum">     508 </span>            :                         return;
<span class="lineNum">     509 </span>            :                     }
<span class="lineNum">     510 </span>            :                 case SkPaint::kBevel_Join:
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :                     if (!rect.width()) {</span>
<span class="lineNum">     512 </span>            :                         this-&gt;drawRect(clip, paint, viewMatrix,
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :                                        {rect.fLeft - r, rect.fTop, rect.fRight + r, rect.fBottom},</span>
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :                                        &amp;GrStyle::SimpleFill());</span>
<span class="lineNum">     515 </span>            :                     } else {
<span class="lineNum">     516 </span>            :                         this-&gt;drawRect(clip, paint, viewMatrix,
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :                                        {rect.fLeft, rect.fTop - r, rect.fRight, rect.fBottom + r},</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :                                        &amp;GrStyle::SimpleFill());</span>
<span class="lineNum">     519 </span>            :                     }
<span class="lineNum">     520 </span>            :                     return;
<span class="lineNum">     521 </span>            :                 }
<span class="lineNum">     522 </span>            :         }
<span class="lineNum">     523 </span>            : 
<span class="lineNum">     524 </span>            :         bool useHWAA;
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :         bool snapToPixelCenters = false;</span>
<span class="lineNum">     526 </span>            :         SkAutoTUnref&lt;GrDrawBatch&gt; batch;
<span class="lineNum">     527 </span>            : 
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :         GrColor color = paint.getColor();</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :         if (should_apply_coverage_aa(paint, fRenderTarget.get(), &amp;useHWAA)) {</span>
<span class="lineNum">     530 </span>            :             // The stroke path needs the rect to remain axis aligned (no rotation or skew).
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :             if (viewMatrix.rectStaysRect()) {</span>
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :                 batch.reset(GrRectBatchFactory::CreateAAStroke(color, viewMatrix, rect, stroke));</span>
<span class="lineNum">     533 </span>            :             }
<span class="lineNum">     534 </span>            :         } else {
<span class="lineNum">     535 </span>            :             // Depending on sub-pixel coordinates and the particular GPU, we may lose a corner of
<span class="lineNum">     536 </span>            :             // hairline rects. We jam all the vertices to pixel centers to avoid this, but not
<span class="lineNum">     537 </span>            :             // when MSAA is enabled because it can cause ugly artifacts.
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :             snapToPixelCenters = stroke.getStyle() == SkStrokeRec::kHairline_Style &amp;&amp;</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :                                  !fRenderTarget-&gt;isUnifiedMultisampled();</span>
<span class="lineNum">     540 </span>            :             batch.reset(GrRectBatchFactory::CreateNonAAStroke(color, viewMatrix, rect,
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :                                                               stroke, snapToPixelCenters));</span>
<span class="lineNum">     542 </span>            :         }
<span class="lineNum">     543 </span>            : 
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :         if (batch) {</span>
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :             GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">     546 </span>            : 
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :             if (snapToPixelCenters) {</span>
<span class="lineNum">     548 </span>            :                 pipelineBuilder.setState(GrPipelineBuilder::kSnapVerticesToPixelCenters_Flag,
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :                                          snapToPixelCenters);</span>
<span class="lineNum">     550 </span>            :             }
<span class="lineNum">     551 </span>            : 
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :             this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">     553 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     554 </span>            :         }
<span class="lineNum">     555 </span>            :     }
<span class="lineNum">     556 </span>            : 
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :     SkPath path;</span>
<span class="lineNum">     558 </span>            :     path.setIsVolatile(true);
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :     path.addRect(rect);</span>
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :     this-&gt;internalDrawPath(clip, paint, viewMatrix, path, *style);</span>
<span class="lineNum">     561 </span>            : }
<span class="lineNum">     562 </span>            : 
<span class="lineNum">     563 </span><span class="lineNoCov">          0 : void GrDrawContextPriv::clearStencilClip(const GrFixedClip&amp; clip, bool insideStencilMask) {</span>
<span class="lineNum">     564 </span>            :     ASSERT_SINGLE_OWNER_PRIV
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED_PRIV</span>
<span class="lineNum">     566 </span>            :     SkDEBUGCODE(fDrawContext-&gt;validate();)
<span class="lineNum">     567 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fDrawContext-&gt;fAuditTrail, &quot;GrDrawContextPriv::clearStencilClip&quot;);</span>
<span class="lineNum">     568 </span>            : 
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawContext-&gt;fDrawingManager);</span>
<span class="lineNum">     570 </span>            :     fDrawContext-&gt;getDrawTarget()-&gt;clearStencilClip(clip, insideStencilMask,
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :                                                     fDrawContext-&gt;accessRenderTarget());</span>
<a name="572"><span class="lineNum">     572 </span>            : }</a>
<span class="lineNum">     573 </span>            : 
<span class="lineNum">     574 </span><span class="lineNoCov">          0 : void GrDrawContextPriv::stencilPath(const GrClip&amp; clip, </span>
<span class="lineNum">     575 </span>            :                                     bool useHWAA,
<span class="lineNum">     576 </span>            :                                     const SkMatrix&amp; viewMatrix,
<span class="lineNum">     577 </span>            :                                     const GrPath* path) {
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :     fDrawContext-&gt;getDrawTarget()-&gt;stencilPath(fDrawContext, clip, useHWAA, viewMatrix, path);</span>
<span class="lineNum">     579 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     580 </span>            : 
<span class="lineNum">     581 </span><span class="lineNoCov">          0 : void GrDrawContextPriv::stencilRect(const GrClip&amp; clip,</span>
<span class="lineNum">     582 </span>            :                                     const GrUserStencilSettings* ss,
<span class="lineNum">     583 </span>            :                                     bool useHWAA,
<span class="lineNum">     584 </span>            :                                     const SkMatrix&amp; viewMatrix,
<span class="lineNum">     585 </span>            :                                     const SkRect&amp; rect) {
<span class="lineNum">     586 </span>            :     ASSERT_SINGLE_OWNER_PRIV
<span class="lineNum">     587 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED_PRIV</span>
<span class="lineNum">     588 </span>            :     SkDEBUGCODE(fDrawContext-&gt;validate();)
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fDrawContext-&gt;fAuditTrail, &quot;GrDrawContext::stencilRect&quot;);</span>
<span class="lineNum">     590 </span>            : 
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawContext-&gt;fDrawingManager);</span>
<span class="lineNum">     592 </span>            : 
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :     GrPaint paint;</span>
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :     paint.setAntiAlias(useHWAA);</span>
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :     paint.setXPFactory(GrDisableColorXPFactory::Make());</span>
<span class="lineNum">     596 </span>            : 
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :     fDrawContext-&gt;drawNonAAFilledRect(clip, paint, viewMatrix, rect, nullptr, nullptr, ss, useHWAA);</span>
<span class="lineNum">     598 </span>            : }
<span class="lineNum">     599 </span>            : 
<span class="lineNum">     600 </span><span class="lineNoCov">          0 : bool GrDrawContextPriv::drawAndStencilRect(const GrClip&amp; clip,</span>
<span class="lineNum">     601 </span>            :                                            const GrUserStencilSettings* ss,
<span class="lineNum">     602 </span>            :                                            SkRegion::Op op,
<span class="lineNum">     603 </span>            :                                            bool invert,
<span class="lineNum">     604 </span>            :                                            bool doAA,
<span class="lineNum">     605 </span>            :                                            const SkMatrix&amp; viewMatrix,
<span class="lineNum">     606 </span>            :                                            const SkRect&amp; rect) {
<span class="lineNum">     607 </span>            :     ASSERT_SINGLE_OWNER_PRIV
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :     RETURN_FALSE_IF_ABANDONED_PRIV</span>
<span class="lineNum">     609 </span>            :     SkDEBUGCODE(fDrawContext-&gt;validate();)
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fDrawContext-&gt;fAuditTrail, &quot;GrDrawContext::drawAndStencilRect&quot;);</span>
<span class="lineNum">     611 </span>            : 
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawContext-&gt;fDrawingManager);</span>
<span class="lineNum">     613 </span>            : 
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :     GrPaint paint;</span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :     paint.setAntiAlias(doAA);</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :     paint.setCoverageSetOpXPFactory(op, invert);</span>
<span class="lineNum">     617 </span>            : 
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :     if (fDrawContext-&gt;drawFilledRect(clip, paint, viewMatrix, rect, ss)) {</span>
<span class="lineNum">     619 </span>            :         return true;
<span class="lineNum">     620 </span>            :     }
<span class="lineNum">     621 </span>            : 
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :     SkPath path;</span>
<span class="lineNum">     623 </span>            :     path.setIsVolatile(true);
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :     path.addRect(rect);</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :     return this-&gt;drawAndStencilPath(clip, ss, op, invert, doAA, viewMatrix, path);</span>
<span class="lineNum">     626 </span>            : }
<span class="lineNum">     627 </span>            : 
<span class="lineNum">     628 </span><span class="lineNoCov">          0 : void GrDrawContext::fillRectToRect(const GrClip&amp; clip,</span>
<span class="lineNum">     629 </span>            :                                    const GrPaint&amp; paint,
<span class="lineNum">     630 </span>            :                                    const SkMatrix&amp; viewMatrix,
<span class="lineNum">     631 </span>            :                                    const SkRect&amp; rectToDraw,
<span class="lineNum">     632 </span>            :                                    const SkRect&amp; localRect) {
<span class="lineNum">     633 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     635 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::fillRectToRect&quot;);</span>
<span class="lineNum">     637 </span>            : 
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :     SkRect croppedRect = rectToDraw;</span>
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :     SkRect croppedLocalRect = localRect;</span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :     if (!crop_filled_rect(this-&gt;width(), this-&gt;height(), clip, viewMatrix,</span>
<span class="lineNum">     641 </span><span class="lineNoCov">          0 :                           &amp;croppedRect, &amp;croppedLocalRect)) {</span>
<span class="lineNum">     642 </span>            :         return;
<span class="lineNum">     643 </span>            :     }
<span class="lineNum">     644 </span>            : 
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">     646 </span>            :     bool useHWAA;
<span class="lineNum">     647 </span>            : 
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :     if (GrCaps::InstancedSupport::kNone != fContext-&gt;caps()-&gt;instancedSupport()) {</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :         InstancedRendering* ir = this-&gt;getDrawTarget()-&gt;instancedRendering();</span>
<span class="lineNum">     650 </span>            :         SkAutoTUnref&lt;GrDrawBatch&gt; batch(ir-&gt;recordRect(croppedRect, viewMatrix, paint.getColor(),
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :                                                        croppedLocalRect, paint.isAntiAlias(),</span>
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :                                                        fInstancedPipelineInfo, &amp;useHWAA));</span>
<span class="lineNum">     653 </span><span class="lineNoCov">          0 :         if (batch) {</span>
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :             GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">     655 </span><span class="lineNoCov">          0 :             this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">     656 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     657 </span>            :         }
<span class="lineNum">     658 </span>            :     }
<span class="lineNum">     659 </span>            : 
<span class="lineNum">     660 </span><span class="lineNoCov">          0 :     if (!should_apply_coverage_aa(paint, fRenderTarget.get(), &amp;useHWAA)) {</span>
<span class="lineNum">     661 </span>            :         this-&gt;drawNonAAFilledRect(clip, paint, viewMatrix, croppedRect, &amp;croppedLocalRect,
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :                                   nullptr, nullptr, useHWAA);</span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     664 </span>            :     }
<span class="lineNum">     665 </span>            : 
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :     if (view_matrix_ok_for_aa_fill_rect(viewMatrix)) {</span>
<span class="lineNum">     667 </span>            :         SkAutoTUnref&lt;GrDrawBatch&gt; batch(GrAAFillRectBatch::CreateWithLocalRect(paint.getColor(),
<span class="lineNum">     668 </span>            :                                                                                viewMatrix,
<span class="lineNum">     669 </span>            :                                                                                croppedRect,
<span class="lineNum">     670 </span><span class="lineNoCov">          0 :                                                                                croppedLocalRect));</span>
<span class="lineNum">     671 </span><span class="lineNoCov">          0 :         GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">     672 </span><span class="lineNoCov">          0 :         this-&gt;drawBatch(pipelineBuilder, clip, batch);</span>
<span class="lineNum">     673 </span>            :         return;
<span class="lineNum">     674 </span>            :     }
<span class="lineNum">     675 </span>            : 
<span class="lineNum">     676 </span>            :     SkMatrix viewAndUnLocalMatrix;
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :     if (!viewAndUnLocalMatrix.setRectToRect(localRect, rectToDraw, SkMatrix::kFill_ScaleToFit)) {</span>
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :         SkDebugf(&quot;fillRectToRect called with empty local matrix.\n&quot;);</span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     680 </span>            :     }
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :     viewAndUnLocalMatrix.postConcat(viewMatrix);</span>
<span class="lineNum">     682 </span>            : 
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :     SkPath path;</span>
<span class="lineNum">     684 </span>            :     path.setIsVolatile(true);
<span class="lineNum">     685 </span><span class="lineNoCov">          0 :     path.addRect(localRect);</span>
<span class="lineNum">     686 </span><span class="lineNoCov">          0 :     this-&gt;internalDrawPath(clip, paint, viewAndUnLocalMatrix, path, GrStyle());</span>
<span class="lineNum">     687 </span>            : }
<span class="lineNum">     688 </span>            : 
<span class="lineNum">     689 </span><span class="lineNoCov">          0 : void GrDrawContext::fillRectWithLocalMatrix(const GrClip&amp; clip,</span>
<span class="lineNum">     690 </span>            :                                             const GrPaint&amp; paint,
<span class="lineNum">     691 </span>            :                                             const SkMatrix&amp; viewMatrix,
<span class="lineNum">     692 </span>            :                                             const SkRect&amp; rectToDraw,
<span class="lineNum">     693 </span>            :                                             const SkMatrix&amp; localMatrix) {
<span class="lineNum">     694 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     696 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::fillRectWithLocalMatrix&quot;);</span>
<span class="lineNum">     698 </span>            : 
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :     SkRect croppedRect = rectToDraw;</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :     if (!crop_filled_rect(this-&gt;width(), this-&gt;height(), clip, viewMatrix, &amp;croppedRect)) {</span>
<span class="lineNum">     701 </span>            :         return;
<span class="lineNum">     702 </span>            :     }
<span class="lineNum">     703 </span>            : 
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">     705 </span>            :     bool useHWAA;
<span class="lineNum">     706 </span>            : 
<span class="lineNum">     707 </span><span class="lineNoCov">          0 :     if (GrCaps::InstancedSupport::kNone != fContext-&gt;caps()-&gt;instancedSupport()) {</span>
<span class="lineNum">     708 </span><span class="lineNoCov">          0 :         InstancedRendering* ir = this-&gt;getDrawTarget()-&gt;instancedRendering();</span>
<span class="lineNum">     709 </span>            :         SkAutoTUnref&lt;GrDrawBatch&gt; batch(ir-&gt;recordRect(croppedRect, viewMatrix, paint.getColor(),
<span class="lineNum">     710 </span><span class="lineNoCov">          0 :                                                        localMatrix, paint.isAntiAlias(),</span>
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :                                                        fInstancedPipelineInfo, &amp;useHWAA));</span>
<span class="lineNum">     712 </span><span class="lineNoCov">          0 :         if (batch) {</span>
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :             GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :             this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     716 </span>            :         }
<span class="lineNum">     717 </span>            :     }
<span class="lineNum">     718 </span>            : 
<span class="lineNum">     719 </span><span class="lineNoCov">          0 :     if (!should_apply_coverage_aa(paint, fRenderTarget.get(), &amp;useHWAA)) {</span>
<span class="lineNum">     720 </span>            :         this-&gt;drawNonAAFilledRect(clip, paint, viewMatrix, croppedRect, nullptr,
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :                                   &amp;localMatrix, nullptr, useHWAA);</span>
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     723 </span>            :     }
<span class="lineNum">     724 </span>            : 
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :     if (view_matrix_ok_for_aa_fill_rect(viewMatrix)) {</span>
<span class="lineNum">     726 </span>            :         SkAutoTUnref&lt;GrDrawBatch&gt; batch(GrAAFillRectBatch::Create(paint.getColor(), viewMatrix,
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :                                                                   localMatrix, croppedRect));</span>
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :         GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :         this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">     730 </span>            :         return;
<span class="lineNum">     731 </span>            :     }
<span class="lineNum">     732 </span>            : 
<span class="lineNum">     733 </span>            :     SkMatrix viewAndUnLocalMatrix;
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :     if (!localMatrix.invert(&amp;viewAndUnLocalMatrix)) {</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :         SkDebugf(&quot;fillRectWithLocalMatrix called with degenerate local matrix.\n&quot;);</span>
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     737 </span>            :     }
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :     viewAndUnLocalMatrix.postConcat(viewMatrix);</span>
<span class="lineNum">     739 </span>            : 
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :     SkPath path;</span>
<span class="lineNum">     741 </span>            :     path.setIsVolatile(true);
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :     path.addRect(rectToDraw);</span>
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :     path.transform(localMatrix);</span>
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :     this-&gt;internalDrawPath(clip, paint, viewAndUnLocalMatrix, path, GrStyle());</span>
<span class="lineNum">     745 </span>            : }
<span class="lineNum">     746 </span>            : 
<span class="lineNum">     747 </span><span class="lineNoCov">          0 : void GrDrawContext::drawVertices(const GrClip&amp; clip,</span>
<span class="lineNum">     748 </span>            :                                  const GrPaint&amp; paint,
<span class="lineNum">     749 </span>            :                                  const SkMatrix&amp; viewMatrix,
<span class="lineNum">     750 </span>            :                                  GrPrimitiveType primitiveType,
<span class="lineNum">     751 </span>            :                                  int vertexCount,
<span class="lineNum">     752 </span>            :                                  const SkPoint positions[],
<span class="lineNum">     753 </span>            :                                  const SkPoint texCoords[],
<span class="lineNum">     754 </span>            :                                  const GrColor colors[],
<span class="lineNum">     755 </span>            :                                  const uint16_t indices[],
<span class="lineNum">     756 </span>            :                                  int indexCount) {
<span class="lineNum">     757 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     759 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawVertices&quot;);</span>
<span class="lineNum">     761 </span>            : 
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">     763 </span>            : 
<span class="lineNum">     764 </span>            :     // TODO clients should give us bounds
<span class="lineNum">     765 </span>            :     SkRect bounds;
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :     if (!bounds.setBoundsCheck(positions, vertexCount)) {</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :         SkDebugf(&quot;drawVertices call empty bounds\n&quot;);</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     769 </span>            :     }
<span class="lineNum">     770 </span>            : 
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :     viewMatrix.mapRect(&amp;bounds);</span>
<span class="lineNum">     772 </span>            : 
<span class="lineNum">     773 </span>            :     SkAutoTUnref&lt;GrDrawBatch&gt; batch(new GrDrawVerticesBatch(paint.getColor(),
<span class="lineNum">     774 </span>            :                                                             primitiveType, viewMatrix, positions,
<span class="lineNum">     775 </span>            :                                                             vertexCount, indices, indexCount,
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :                                                             colors, texCoords, bounds));</span>
<span class="lineNum">     777 </span>            : 
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :     GrPipelineBuilder pipelineBuilder(paint, this-&gt;mustUseHWAA(paint));</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :     this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">     780 </span>            : }
<span class="lineNum">     781 </span>            : 
<span class="lineNum">     782 </span>            : ///////////////////////////////////////////////////////////////////////////////
<span class="lineNum">     783 </span>            : 
<span class="lineNum">     784 </span><span class="lineNoCov">          0 : void GrDrawContext::drawAtlas(const GrClip&amp; clip,</span>
<span class="lineNum">     785 </span>            :                               const GrPaint&amp; paint,
<span class="lineNum">     786 </span>            :                               const SkMatrix&amp; viewMatrix,
<span class="lineNum">     787 </span>            :                               int spriteCount,
<span class="lineNum">     788 </span>            :                               const SkRSXform xform[],
<span class="lineNum">     789 </span>            :                               const SkRect texRect[],
<span class="lineNum">     790 </span>            :                               const SkColor colors[]) {
<span class="lineNum">     791 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     793 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawAtlas&quot;);</span>
<span class="lineNum">     795 </span>            : 
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">     797 </span>            : 
<span class="lineNum">     798 </span>            :     SkAutoTUnref&lt;GrDrawBatch&gt; batch(new GrDrawAtlasBatch(paint.getColor(), viewMatrix, spriteCount,
<span class="lineNum">     799 </span><span class="lineNoCov">          0 :                                                          xform, texRect, colors));</span>
<span class="lineNum">     800 </span>            : 
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :     GrPipelineBuilder pipelineBuilder(paint, this-&gt;mustUseHWAA(paint));</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :     this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">     803 </span>            : }
<span class="lineNum">     804 </span>            : 
<span class="lineNum">     805 </span>            : ///////////////////////////////////////////////////////////////////////////////
<span class="lineNum">     806 </span>            : 
<span class="lineNum">     807 </span><span class="lineNoCov">          0 : void GrDrawContext::drawRRect(const GrClip&amp; origClip,</span>
<span class="lineNum">     808 </span>            :                               const GrPaint&amp; paint,
<span class="lineNum">     809 </span>            :                               const SkMatrix&amp; viewMatrix,
<span class="lineNum">     810 </span>            :                               const SkRRect&amp; rrect,
<span class="lineNum">     811 </span>            :                               const GrStyle&amp; style) {
<span class="lineNum">     812 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     814 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawRRect&quot;);</span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :     if (rrect.isEmpty()) {</span>
<span class="lineNum">     817 </span>            :        return;
<span class="lineNum">     818 </span>            :     }
<span class="lineNum">     819 </span>            : 
<span class="lineNum">     820 </span><span class="lineNoCov">          0 :     GrNoClip noclip;</span>
<span class="lineNum">     821 </span><span class="lineNoCov">          0 :     const GrClip* clip = &amp;origClip;</span>
<span class="lineNum">     822 </span>            : #ifdef SK_BUILD_FOR_ANDROID_FRAMEWORK
<span class="lineNum">     823 </span>            :     // The Android framework frequently clips rrects to themselves where the clip is non-aa and the
<span class="lineNum">     824 </span>            :     // draw is aa. Since our lower level clip code works from batch bounds, which are SkRects, it
<span class="lineNum">     825 </span>            :     // doesn't detect that the clip can be ignored (modulo antialiasing). The following test
<span class="lineNum">     826 </span>            :     // attempts to mitigate the stencil clip cost but will only help when the entire clip stack
<span class="lineNum">     827 </span>            :     // can be ignored. We'd prefer to fix this in the framework by removing the clips calls.
<span class="lineNum">     828 </span>            :     SkRRect devRRect;
<span class="lineNum">     829 </span>            :     if (rrect.transform(viewMatrix, &amp;devRRect) &amp;&amp; clip-&gt;quickContains(devRRect)) {
<span class="lineNum">     830 </span>            :         clip = &amp;noclip;
<span class="lineNum">     831 </span>            :     }
<span class="lineNum">     832 </span>            : #endif
<span class="lineNum">     833 </span>            :     SkASSERT(!style.pathEffect()); // this should've been devolved to a path in SkGpuDevice
<span class="lineNum">     834 </span>            : 
<span class="lineNum">     835 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">     836 </span><span class="lineNoCov">          0 :     const SkStrokeRec stroke = style.strokeRec();</span>
<span class="lineNum">     837 </span>            :     bool useHWAA;
<span class="lineNum">     838 </span>            : 
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :     if (GrCaps::InstancedSupport::kNone != fContext-&gt;caps()-&gt;instancedSupport() &amp;&amp;</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :         stroke.isFillStyle()) {</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :         InstancedRendering* ir = this-&gt;getDrawTarget()-&gt;instancedRendering();</span>
<span class="lineNum">     842 </span>            :         SkAutoTUnref&lt;GrDrawBatch&gt; batch(ir-&gt;recordRRect(rrect, viewMatrix, paint.getColor(),
<span class="lineNum">     843 </span><span class="lineNoCov">          0 :                                                         paint.isAntiAlias(), fInstancedPipelineInfo,</span>
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :                                                         &amp;useHWAA));</span>
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :         if (batch) {</span>
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :             GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :             this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, *clip, batch);</span>
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     849 </span>            :         }
<span class="lineNum">     850 </span>            :     }
<span class="lineNum">     851 </span>            : 
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :     if (should_apply_coverage_aa(paint, fRenderTarget.get(), &amp;useHWAA)) {</span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :         GrShaderCaps* shaderCaps = fContext-&gt;caps()-&gt;shaderCaps();</span>
<span class="lineNum">     854 </span>            :         SkAutoTUnref&lt;GrDrawBatch&gt; batch(GrOvalRenderer::CreateRRectBatch(paint.getColor(),
<span class="lineNum">     855 </span>            :                                                                          viewMatrix,
<span class="lineNum">     856 </span>            :                                                                          rrect,
<span class="lineNum">     857 </span>            :                                                                          stroke,
<span class="lineNum">     858 </span><span class="lineNoCov">          0 :                                                                          shaderCaps));</span>
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :         if (batch) {</span>
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :             GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :             this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, *clip, batch);</span>
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     863 </span>            :         }
<span class="lineNum">     864 </span>            :     }
<span class="lineNum">     865 </span>            : 
<span class="lineNum">     866 </span><span class="lineNoCov">          0 :     SkPath path;</span>
<span class="lineNum">     867 </span>            :     path.setIsVolatile(true);
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :     path.addRRect(rrect);</span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :     this-&gt;internalDrawPath(*clip, paint, viewMatrix, path, style);</span>
<span class="lineNum">     870 </span>            : }
<span class="lineNum">     871 </span>            : 
<span class="lineNum">     872 </span><span class="lineNoCov">          0 : bool GrDrawContext::drawFilledDRRect(const GrClip&amp; clip,</span>
<span class="lineNum">     873 </span>            :                                      const GrPaint&amp; paintIn,
<span class="lineNum">     874 </span>            :                                      const SkMatrix&amp; viewMatrix,
<span class="lineNum">     875 </span>            :                                      const SkRRect&amp; origOuter,
<span class="lineNum">     876 </span>            :                                      const SkRRect&amp; origInner) {
<span class="lineNum">     877 </span>            :     SkASSERT(!origInner.isEmpty());
<span class="lineNum">     878 </span>            :     SkASSERT(!origOuter.isEmpty());
<span class="lineNum">     879 </span>            : 
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :     if (GrCaps::InstancedSupport::kNone != fContext-&gt;caps()-&gt;instancedSupport()) {</span>
<span class="lineNum">     881 </span>            :         bool useHWAA;
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :         InstancedRendering* ir = this-&gt;getDrawTarget()-&gt;instancedRendering();</span>
<span class="lineNum">     883 </span>            :         SkAutoTUnref&lt;GrDrawBatch&gt; batch(ir-&gt;recordDRRect(origOuter, origInner, viewMatrix,
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :                                                          paintIn.getColor(), paintIn.isAntiAlias(),</span>
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :                                                          fInstancedPipelineInfo, &amp;useHWAA));</span>
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :         if (batch) {</span>
<span class="lineNum">     887 </span><span class="lineNoCov">          0 :             GrPipelineBuilder pipelineBuilder(paintIn, useHWAA);</span>
<span class="lineNum">     888 </span><span class="lineNoCov">          0 :             this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :             return true;</span>
<span class="lineNum">     890 </span>            :         }
<span class="lineNum">     891 </span>            :     }
<span class="lineNum">     892 </span>            : 
<span class="lineNum">     893 </span><span class="lineNoCov">          0 :     bool applyAA = paintIn.isAntiAlias() &amp;&amp; !fRenderTarget-&gt;isUnifiedMultisampled();</span>
<span class="lineNum">     894 </span>            : 
<span class="lineNum">     895 </span>            :     GrPrimitiveEdgeType innerEdgeType = applyAA ? kInverseFillAA_GrProcessorEdgeType :
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :                                                   kInverseFillBW_GrProcessorEdgeType;</span>
<span class="lineNum">     897 </span>            :     GrPrimitiveEdgeType outerEdgeType = applyAA ? kFillAA_GrProcessorEdgeType :
<span class="lineNum">     898 </span><span class="lineNoCov">          0 :                                                   kFillBW_GrProcessorEdgeType;</span>
<span class="lineNum">     899 </span>            : 
<span class="lineNum">     900 </span>            :     SkTCopyOnFirstWrite&lt;SkRRect&gt; inner(origInner), outer(origOuter);
<span class="lineNum">     901 </span>            :     SkMatrix inverseVM;
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :     if (!viewMatrix.isIdentity()) {</span>
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :         if (!origInner.transform(viewMatrix, inner.writable())) {</span>
<span class="lineNum">     904 </span>            :             return false;
<span class="lineNum">     905 </span>            :         }
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :         if (!origOuter.transform(viewMatrix, outer.writable())) {</span>
<span class="lineNum">     907 </span>            :             return false;
<span class="lineNum">     908 </span>            :         }
<span class="lineNum">     909 </span><span class="lineNoCov">          0 :         if (!viewMatrix.invert(&amp;inverseVM)) {</span>
<span class="lineNum">     910 </span>            :             return false;
<span class="lineNum">     911 </span>            :         }
<span class="lineNum">     912 </span>            :     } else {
<span class="lineNum">     913 </span><span class="lineNoCov">          0 :         inverseVM.reset();</span>
<span class="lineNum">     914 </span>            :     }
<span class="lineNum">     915 </span>            : 
<span class="lineNum">     916 </span><span class="lineNoCov">          0 :     GrPaint grPaint(paintIn);</span>
<span class="lineNum">     917 </span>            :     grPaint.setAntiAlias(false);
<span class="lineNum">     918 </span>            : 
<span class="lineNum">     919 </span>            :     // TODO these need to be a geometry processors
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :     sk_sp&lt;GrFragmentProcessor&gt; innerEffect(GrRRectEffect::Make(innerEdgeType, *inner));</span>
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :     if (!innerEffect) {</span>
<span class="lineNum">     922 </span>            :         return false;
<span class="lineNum">     923 </span>            :     }
<span class="lineNum">     924 </span>            : 
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :     sk_sp&lt;GrFragmentProcessor&gt; outerEffect(GrRRectEffect::Make(outerEdgeType, *outer));</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :     if (!outerEffect) {</span>
<span class="lineNum">     927 </span>            :         return false;
<span class="lineNum">     928 </span>            :     }
<span class="lineNum">     929 </span>            : 
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :     grPaint.addCoverageFragmentProcessor(std::move(innerEffect));</span>
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :     grPaint.addCoverageFragmentProcessor(std::move(outerEffect));</span>
<span class="lineNum">     932 </span>            : 
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :     SkRect bounds = outer-&gt;getBounds();</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :     if (applyAA) {</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :         bounds.outset(SK_ScalarHalf, SK_ScalarHalf);</span>
<span class="lineNum">     936 </span>            :     }
<span class="lineNum">     937 </span>            : 
<span class="lineNum">     938 </span><span class="lineNoCov">          0 :     this-&gt;fillRectWithLocalMatrix(clip, grPaint, SkMatrix::I(), bounds, inverseVM);</span>
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :     return true;</span>
<span class="lineNum">     940 </span>            : }
<span class="lineNum">     941 </span>            : 
<span class="lineNum">     942 </span><span class="lineNoCov">          0 : void GrDrawContext::drawDRRect(const GrClip&amp; clip,</span>
<span class="lineNum">     943 </span>            :                                const GrPaint&amp; paint,
<span class="lineNum">     944 </span>            :                                const SkMatrix&amp; viewMatrix,
<span class="lineNum">     945 </span>            :                                const SkRRect&amp; outer,
<span class="lineNum">     946 </span>            :                                const SkRRect&amp; inner) {
<span class="lineNum">     947 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     948 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     949 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     950 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawDRRect&quot;);</span>
<span class="lineNum">     951 </span>            : 
<span class="lineNum">     952 </span>            :     SkASSERT(!outer.isEmpty());
<span class="lineNum">     953 </span>            :     SkASSERT(!inner.isEmpty());
<span class="lineNum">     954 </span>            : 
<span class="lineNum">     955 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">     956 </span>            : 
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :     if (this-&gt;drawFilledDRRect(clip, paint, viewMatrix, outer, inner)) {</span>
<span class="lineNum">     958 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     959 </span>            :     }
<span class="lineNum">     960 </span>            : 
<span class="lineNum">     961 </span><span class="lineNoCov">          0 :     SkPath path;</span>
<span class="lineNum">     962 </span>            :     path.setIsVolatile(true);
<span class="lineNum">     963 </span><span class="lineNoCov">          0 :     path.addRRect(inner);</span>
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :     path.addRRect(outer);</span>
<span class="lineNum">     965 </span><span class="lineNoCov">          0 :     path.setFillType(SkPath::kEvenOdd_FillType);</span>
<span class="lineNum">     966 </span>            : 
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :     this-&gt;internalDrawPath(clip, paint, viewMatrix, path, GrStyle::SimpleFill());</span>
<span class="lineNum">     968 </span>            : }
<span class="lineNum">     969 </span>            : 
<a name="970"><span class="lineNum">     970 </span>            : ///////////////////////////////////////////////////////////////////////////////</a>
<span class="lineNum">     971 </span>            : 
<span class="lineNum">     972 </span><span class="lineNoCov">          0 : static inline bool is_int(float x) {</span>
<span class="lineNum">     973 </span><span class="lineNoCov">          0 :     return x == (float) sk_float_round2int(x);</span>
<span class="lineNum">     974 </span>            : }
<span class="lineNum">     975 </span>            : 
<span class="lineNum">     976 </span><span class="lineNoCov">          0 : void GrDrawContext::drawRegion(const GrClip&amp; clip,</span>
<span class="lineNum">     977 </span>            :                                const GrPaint&amp; paint,
<span class="lineNum">     978 </span>            :                                const SkMatrix&amp; viewMatrix,
<span class="lineNum">     979 </span>            :                                const SkRegion&amp; region,
<span class="lineNum">     980 </span>            :                                const GrStyle&amp; style) {
<span class="lineNum">     981 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">     982 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">     983 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">     984 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawRegion&quot;);</span>
<span class="lineNum">     985 </span>            : 
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :     bool isNonTranslate = SkToBool(viewMatrix.getType() &amp; ~(SkMatrix::kTranslate_Mask));</span>
<span class="lineNum">     987 </span><span class="lineNoCov">          0 :     bool complexStyle = !style.isSimpleFill();</span>
<span class="lineNum">     988 </span><span class="lineNoCov">          0 :     bool antiAlias = paint.isAntiAlias() &amp;&amp; (!is_int(viewMatrix.getTranslateX()) ||</span>
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :                                              !is_int(viewMatrix.getTranslateY()));</span>
<span class="lineNum">     990 </span><span class="lineNoCov">          0 :     if (isNonTranslate || complexStyle || antiAlias) {</span>
<span class="lineNum">     991 </span><span class="lineNoCov">          0 :         SkPath path;</span>
<span class="lineNum">     992 </span><span class="lineNoCov">          0 :         region.getBoundaryPath(&amp;path);</span>
<span class="lineNum">     993 </span><span class="lineNoCov">          0 :         return this-&gt;drawPath(clip, paint, viewMatrix, path, style);</span>
<span class="lineNum">     994 </span>            :     }
<span class="lineNum">     995 </span>            : 
<span class="lineNum">     996 </span><span class="lineNoCov">          0 :     SkAutoTUnref&lt;GrDrawBatch&gt; batch(GrRegionBatch::Create(paint.getColor(), viewMatrix, region));</span>
<span class="lineNum">     997 </span><span class="lineNoCov">          0 :     GrPipelineBuilder pipelineBuilder(paint, false);</span>
<span class="lineNum">     998 </span><span class="lineNoCov">          0 :     this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">     999 </span>            : }
<span class="lineNum">    1000 </span>            : 
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 : void GrDrawContext::drawOval(const GrClip&amp; clip,</span>
<span class="lineNum">    1002 </span>            :                              const GrPaint&amp; paint,
<span class="lineNum">    1003 </span>            :                              const SkMatrix&amp; viewMatrix,
<span class="lineNum">    1004 </span>            :                              const SkRect&amp; oval,
<span class="lineNum">    1005 </span>            :                              const GrStyle&amp; style) {
<span class="lineNum">    1006 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">    1008 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawOval&quot;);</span>
<span class="lineNum">    1010 </span>            : 
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :     if (oval.isEmpty()) {</span>
<span class="lineNum">    1012 </span>            :        return;
<span class="lineNum">    1013 </span>            :     }
<span class="lineNum">    1014 </span>            : 
<span class="lineNum">    1015 </span>            :     SkASSERT(!style.pathEffect()); // this should've been devolved to a path in SkGpuDevice
<span class="lineNum">    1016 </span>            : 
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :     const SkStrokeRec&amp; stroke = style.strokeRec();</span>
<span class="lineNum">    1019 </span>            :     bool useHWAA;
<span class="lineNum">    1020 </span>            : 
<span class="lineNum">    1021 </span><span class="lineNoCov">          0 :     if (GrCaps::InstancedSupport::kNone != fContext-&gt;caps()-&gt;instancedSupport() &amp;&amp;</span>
<span class="lineNum">    1022 </span><span class="lineNoCov">          0 :         stroke.isFillStyle()) {</span>
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 :         InstancedRendering* ir = this-&gt;getDrawTarget()-&gt;instancedRendering();</span>
<span class="lineNum">    1024 </span>            :         SkAutoTUnref&lt;GrDrawBatch&gt; batch(ir-&gt;recordOval(oval, viewMatrix, paint.getColor(),
<span class="lineNum">    1025 </span><span class="lineNoCov">          0 :                                                        paint.isAntiAlias(), fInstancedPipelineInfo,</span>
<span class="lineNum">    1026 </span><span class="lineNoCov">          0 :                                                        &amp;useHWAA));</span>
<span class="lineNum">    1027 </span><span class="lineNoCov">          0 :         if (batch) {</span>
<span class="lineNum">    1028 </span><span class="lineNoCov">          0 :             GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">    1029 </span><span class="lineNoCov">          0 :             this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1031 </span>            :         }
<span class="lineNum">    1032 </span>            :     }
<span class="lineNum">    1033 </span>            : 
<span class="lineNum">    1034 </span><span class="lineNoCov">          0 :     if (should_apply_coverage_aa(paint, fRenderTarget.get(), &amp;useHWAA)) {</span>
<span class="lineNum">    1035 </span><span class="lineNoCov">          0 :         GrShaderCaps* shaderCaps = fContext-&gt;caps()-&gt;shaderCaps();</span>
<span class="lineNum">    1036 </span>            :         SkAutoTUnref&lt;GrDrawBatch&gt; batch(GrOvalRenderer::CreateOvalBatch(paint.getColor(),
<span class="lineNum">    1037 </span>            :                                                                         viewMatrix,
<span class="lineNum">    1038 </span>            :                                                                         oval,
<span class="lineNum">    1039 </span>            :                                                                         stroke,
<span class="lineNum">    1040 </span><span class="lineNoCov">          0 :                                                                         shaderCaps));</span>
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 :         if (batch) {</span>
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :             GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">    1043 </span><span class="lineNoCov">          0 :             this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">    1044 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1045 </span>            :         }
<span class="lineNum">    1046 </span>            :     }
<span class="lineNum">    1047 </span>            : 
<span class="lineNum">    1048 </span><span class="lineNoCov">          0 :     SkPath path;</span>
<span class="lineNum">    1049 </span>            :     path.setIsVolatile(true);
<span class="lineNum">    1050 </span><span class="lineNoCov">          0 :     path.addOval(oval);</span>
<span class="lineNum">    1051 </span><span class="lineNoCov">          0 :     this-&gt;internalDrawPath(clip, paint, viewMatrix, path, style);</span>
<span class="lineNum">    1052 </span>            : }
<span class="lineNum">    1053 </span>            : 
<span class="lineNum">    1054 </span><span class="lineNoCov">          0 : void GrDrawContext::drawArc(const GrClip&amp; clip,</span>
<span class="lineNum">    1055 </span>            :                             const GrPaint&amp; paint,
<span class="lineNum">    1056 </span>            :                             const SkMatrix&amp; viewMatrix,
<span class="lineNum">    1057 </span>            :                             const SkRect&amp; oval,
<span class="lineNum">    1058 </span>            :                             SkScalar startAngle,
<span class="lineNum">    1059 </span>            :                             SkScalar sweepAngle,
<span class="lineNum">    1060 </span>            :                             bool useCenter,
<span class="lineNum">    1061 </span>            :                             const GrStyle&amp; style) {
<span class="lineNum">    1062 </span>            :     bool useHWAA;
<span class="lineNum">    1063 </span><span class="lineNoCov">          0 :     if (should_apply_coverage_aa(paint, fRenderTarget.get(), &amp;useHWAA)) {</span>
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :         GrShaderCaps* shaderCaps = fContext-&gt;caps()-&gt;shaderCaps();</span>
<span class="lineNum">    1065 </span>            :         SkAutoTUnref&lt;GrDrawBatch&gt; batch(GrOvalRenderer::CreateArcBatch(paint.getColor(),
<span class="lineNum">    1066 </span>            :                                                                        viewMatrix,
<span class="lineNum">    1067 </span>            :                                                                        oval,
<span class="lineNum">    1068 </span>            :                                                                        startAngle,
<span class="lineNum">    1069 </span>            :                                                                        sweepAngle,
<span class="lineNum">    1070 </span>            :                                                                        useCenter,
<span class="lineNum">    1071 </span>            :                                                                        style,
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 :                                                                        shaderCaps));</span>
<span class="lineNum">    1073 </span><span class="lineNoCov">          0 :         if (batch) {</span>
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :             GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">    1075 </span><span class="lineNoCov">          0 :             this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">    1076 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1077 </span>            :         }
<span class="lineNum">    1078 </span>            :     }
<span class="lineNum">    1079 </span><span class="lineNoCov">          0 :     SkPath path;</span>
<span class="lineNum">    1080 </span>            :     SkPathPriv::CreateDrawArcPath(&amp;path, oval, startAngle, sweepAngle, useCenter,
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 :                                   style.isSimpleFill());</span>
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :     this-&gt;internalDrawPath(clip, paint, viewMatrix, path, style);</span>
<span class="lineNum">    1083 </span><span class="lineNoCov">          0 :     return;</span>
<span class="lineNum">    1084 </span>            : }
<span class="lineNum">    1085 </span>            : 
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 : void GrDrawContext::drawImageLattice(const GrClip&amp; clip,</span>
<span class="lineNum">    1087 </span>            :                                      const GrPaint&amp; paint,
<span class="lineNum">    1088 </span>            :                                      const SkMatrix&amp; viewMatrix,
<span class="lineNum">    1089 </span>            :                                      int imageWidth,
<span class="lineNum">    1090 </span>            :                                      int imageHeight,
<span class="lineNum">    1091 </span>            :                                      std::unique_ptr&lt;SkLatticeIter&gt; iter,
<span class="lineNum">    1092 </span>            :                                      const SkRect&amp; dst) {
<span class="lineNum">    1093 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">    1094 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">    1095 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawImageLattice&quot;);</span>
<span class="lineNum">    1097 </span>            : 
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">    1099 </span>            : 
<span class="lineNum">    1100 </span>            :     SkAutoTUnref&lt;GrDrawBatch&gt; batch(GrNinePatch::CreateNonAA(paint.getColor(), viewMatrix,
<span class="lineNum">    1101 </span>            :                                                              imageWidth, imageHeight,
<span class="lineNum">    1102 </span><span class="lineNoCov">          0 :                                                              std::move(iter), dst));</span>
<span class="lineNum">    1103 </span>            : 
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :     GrPipelineBuilder pipelineBuilder(paint, this-&gt;mustUseHWAA(paint));</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :     this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">    1106 </span>            : }
<span class="lineNum">    1107 </span>            : 
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 : void GrDrawContext::prepareForExternalIO() {</span>
<span class="lineNum">    1109 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">    1111 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::prepareForExternalIO&quot;);</span>
<span class="lineNum">    1113 </span>            : 
<span class="lineNum">    1114 </span>            :     ASSERT_OWNED_RESOURCE(fRenderTarget);
<span class="lineNum">    1115 </span>            : 
<span class="lineNum">    1116 </span><span class="lineNoCov">          0 :     fDrawingManager-&gt;prepareSurfaceForExternalIO(fRenderTarget.get());</span>
<span class="lineNum">    1117 </span>            : }
<span class="lineNum">    1118 </span>            : 
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 : void GrDrawContext::drawNonAAFilledRect(const GrClip&amp; clip,</span>
<span class="lineNum">    1120 </span>            :                                         const GrPaint&amp; paint,
<span class="lineNum">    1121 </span>            :                                         const SkMatrix&amp; viewMatrix,
<span class="lineNum">    1122 </span>            :                                         const SkRect&amp; rect,
<span class="lineNum">    1123 </span>            :                                         const SkRect* localRect,
<span class="lineNum">    1124 </span>            :                                         const SkMatrix* localMatrix,
<span class="lineNum">    1125 </span>            :                                         const GrUserStencilSettings* ss,
<span class="lineNum">    1126 </span>            :                                         bool useHWAA) {
<span class="lineNum">    1127 </span>            :     SkASSERT(!useHWAA || this-&gt;isStencilBufferMultisampled());
<span class="lineNum">    1128 </span>            :     SkAutoTUnref&lt;GrDrawBatch&gt; batch(
<span class="lineNum">    1129 </span>            :             GrRectBatchFactory::CreateNonAAFill(paint.getColor(), viewMatrix, rect, localRect,
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :                                                 localMatrix));</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 :     GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 :     if (ss) {</span>
<span class="lineNum">    1133 </span><span class="lineNoCov">          0 :         pipelineBuilder.setUserStencil(ss);</span>
<span class="lineNum">    1134 </span>            :     }
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 :     this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">    1136 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1137 </span>            : 
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 : bool GrDrawContext::readPixels(const SkImageInfo&amp; dstInfo, void* dstBuffer, size_t dstRowBytes,</span>
<span class="lineNum">    1139 </span>            :                                int x, int y) {
<span class="lineNum">    1140 </span>            :     // TODO: teach fRenderTarget to take ImageInfo directly to specify the src pixels
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :     GrPixelConfig config = SkImageInfo2GrPixelConfig(dstInfo, *fContext-&gt;caps());</span>
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :     if (kUnknown_GrPixelConfig == config) {</span>
<span class="lineNum">    1143 </span>            :         return false;
<span class="lineNum">    1144 </span>            :     }
<span class="lineNum">    1145 </span>            : 
<span class="lineNum">    1146 </span><span class="lineNoCov">          0 :     uint32_t flags = 0;</span>
<span class="lineNum">    1147 </span><span class="lineNoCov">          0 :     if (kUnpremul_SkAlphaType == dstInfo.alphaType()) {</span>
<span class="lineNum">    1148 </span><span class="lineNoCov">          0 :         flags = GrContext::kUnpremul_PixelOpsFlag;</span>
<span class="lineNum">    1149 </span>            :     }
<span class="lineNum">    1150 </span>            : 
<span class="lineNum">    1151 </span><span class="lineNoCov">          0 :     return fRenderTarget-&gt;readPixels(x, y, dstInfo.width(), dstInfo.height(),</span>
<span class="lineNum">    1152 </span><span class="lineNoCov">          0 :                                      config, dstBuffer, dstRowBytes, flags);</span>
<span class="lineNum">    1153 </span>            : }
<span class="lineNum">    1154 </span>            : 
<span class="lineNum">    1155 </span><span class="lineNoCov">          0 : bool GrDrawContext::writePixels(const SkImageInfo&amp; srcInfo, const void* srcBuffer,</span>
<span class="lineNum">    1156 </span>            :                                 size_t srcRowBytes, int x, int y) {
<span class="lineNum">    1157 </span>            :     // TODO: teach fRenderTarget to take ImageInfo directly to specify the src pixels
<span class="lineNum">    1158 </span><span class="lineNoCov">          0 :     GrPixelConfig config = SkImageInfo2GrPixelConfig(srcInfo, *fContext-&gt;caps());</span>
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 :     if (kUnknown_GrPixelConfig == config) {</span>
<span class="lineNum">    1160 </span>            :         return false;
<span class="lineNum">    1161 </span>            :     }
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :     uint32_t flags = 0;</span>
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 :     if (kUnpremul_SkAlphaType == srcInfo.alphaType()) {</span>
<span class="lineNum">    1164 </span><span class="lineNoCov">          0 :         flags = GrContext::kUnpremul_PixelOpsFlag;</span>
<span class="lineNum">    1165 </span>            :     }
<span class="lineNum">    1166 </span>            : 
<span class="lineNum">    1167 </span><span class="lineNoCov">          0 :     return fRenderTarget-&gt;writePixels(x, y, srcInfo.width(), srcInfo.height(),</span>
<span class="lineNum">    1168 </span><span class="lineNoCov">          0 :                                       config, srcBuffer, srcRowBytes, flags);</span>
<span class="lineNum">    1169 </span>            : }
<a name="1170"><span class="lineNum">    1170 </span>            : </a>
<span class="lineNum">    1171 </span>            : // Can 'path' be drawn as a pair of filled nested rectangles?
<span class="lineNum">    1172 </span><span class="lineNoCov">          0 : static bool fills_as_nested_rects(const SkMatrix&amp; viewMatrix, const SkPath&amp; path, SkRect rects[2]) {</span>
<span class="lineNum">    1173 </span>            : 
<span class="lineNum">    1174 </span><span class="lineNoCov">          0 :     if (path.isInverseFillType()) {</span>
<span class="lineNum">    1175 </span>            :         return false;
<span class="lineNum">    1176 </span>            :     }
<span class="lineNum">    1177 </span>            : 
<span class="lineNum">    1178 </span>            :     // TODO: this restriction could be lifted if we were willing to apply
<span class="lineNum">    1179 </span>            :     // the matrix to all the points individually rather than just to the rect
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :     if (!viewMatrix.rectStaysRect()) {</span>
<span class="lineNum">    1181 </span>            :         return false;
<span class="lineNum">    1182 </span>            :     }
<span class="lineNum">    1183 </span>            : 
<span class="lineNum">    1184 </span>            :     SkPath::Direction dirs[2];
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :     if (!path.isNestedFillRects(rects, dirs)) {</span>
<span class="lineNum">    1186 </span>            :         return false;
<span class="lineNum">    1187 </span>            :     }
<span class="lineNum">    1188 </span>            : 
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 :     if (SkPath::kWinding_FillType == path.getFillType() &amp;&amp; dirs[0] == dirs[1]) {</span>
<span class="lineNum">    1190 </span>            :         // The two rects need to be wound opposite to each other
<span class="lineNum">    1191 </span>            :         return false;
<span class="lineNum">    1192 </span>            :     }
<span class="lineNum">    1193 </span>            : 
<span class="lineNum">    1194 </span>            :     // Right now, nested rects where the margin is not the same width
<span class="lineNum">    1195 </span>            :     // all around do not render correctly
<span class="lineNum">    1196 </span><span class="lineNoCov">          0 :     const SkScalar* outer = rects[0].asScalars();</span>
<span class="lineNum">    1197 </span><span class="lineNoCov">          0 :     const SkScalar* inner = rects[1].asScalars();</span>
<span class="lineNum">    1198 </span>            : 
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :     bool allEq = true;</span>
<span class="lineNum">    1200 </span>            : 
<span class="lineNum">    1201 </span><span class="lineNoCov">          0 :     SkScalar margin = SkScalarAbs(outer[0] - inner[0]);</span>
<span class="lineNum">    1202 </span><span class="lineNoCov">          0 :     bool allGoE1 = margin &gt;= SK_Scalar1;</span>
<span class="lineNum">    1203 </span>            : 
<span class="lineNum">    1204 </span><span class="lineNoCov">          0 :     for (int i = 1; i &lt; 4; ++i) {</span>
<span class="lineNum">    1205 </span><span class="lineNoCov">          0 :         SkScalar temp = SkScalarAbs(outer[i] - inner[i]);</span>
<span class="lineNum">    1206 </span><span class="lineNoCov">          0 :         if (temp &lt; SK_Scalar1) {</span>
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :             allGoE1 = false;</span>
<span class="lineNum">    1208 </span>            :         }
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :         if (!SkScalarNearlyEqual(margin, temp)) {</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :             allEq = false;</span>
<span class="lineNum">    1211 </span>            :         }
<span class="lineNum">    1212 </span>            :     }
<span class="lineNum">    1213 </span>            : 
<span class="lineNum">    1214 </span><span class="lineNoCov">          0 :     return allEq || allGoE1;</span>
<span class="lineNum">    1215 </span>            : }
<span class="lineNum">    1216 </span>            : 
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 : void GrDrawContext::drawPath(const GrClip&amp; clip,</span>
<span class="lineNum">    1218 </span>            :                              const GrPaint&amp; paint,
<span class="lineNum">    1219 </span>            :                              const SkMatrix&amp; viewMatrix,
<span class="lineNum">    1220 </span>            :                              const SkPath&amp; path,
<span class="lineNum">    1221 </span>            :                              const GrStyle&amp; style) {
<span class="lineNum">    1222 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">    1223 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">    1224 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawPath&quot;);</span>
<span class="lineNum">    1226 </span>            : 
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :     if (path.isEmpty()) {</span>
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 :        if (path.isInverseFillType()) {</span>
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :            this-&gt;drawPaint(clip, paint, viewMatrix);</span>
<span class="lineNum">    1230 </span>            :        }
<span class="lineNum">    1231 </span>            :        return;
<span class="lineNum">    1232 </span>            :     }
<span class="lineNum">    1233 </span>            : 
<span class="lineNum">    1234 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawingManager);</span>
<span class="lineNum">    1235 </span>            : 
<span class="lineNum">    1236 </span>            :     bool useHWAA;
<span class="lineNum">    1237 </span><span class="lineNoCov">          0 :     if (should_apply_coverage_aa(paint, fRenderTarget.get(), &amp;useHWAA) &amp;&amp; !style.pathEffect()) {</span>
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :         if (style.isSimpleFill() &amp;&amp; !path.isConvex()) {</span>
<span class="lineNum">    1239 </span>            :             // Concave AA paths are expensive - try to avoid them for special cases
<span class="lineNum">    1240 </span>            :             SkRect rects[2];
<span class="lineNum">    1241 </span>            : 
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :             if (fills_as_nested_rects(viewMatrix, path, rects)) {</span>
<span class="lineNum">    1243 </span>            :                 SkAutoTUnref&lt;GrDrawBatch&gt; batch(GrRectBatchFactory::CreateAAFillNestedRects(
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :                     paint.getColor(), viewMatrix, rects));</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :                 if (batch) {</span>
<span class="lineNum">    1246 </span><span class="lineNoCov">          0 :                     GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :                     this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">    1248 </span>            :                 }
<span class="lineNum">    1249 </span>            :                 return;
<span class="lineNum">    1250 </span>            :             }
<span class="lineNum">    1251 </span>            :         }
<span class="lineNum">    1252 </span>            :         SkRect ovalRect;
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :         bool isOval = path.isOval(&amp;ovalRect);</span>
<span class="lineNum">    1254 </span>            : 
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 :         if (isOval &amp;&amp; !path.isInverseFillType()) {</span>
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :             GrShaderCaps* shaderCaps = fContext-&gt;caps()-&gt;shaderCaps();</span>
<span class="lineNum">    1257 </span>            :             SkAutoTUnref&lt;GrDrawBatch&gt; batch(GrOvalRenderer::CreateOvalBatch(paint.getColor(),
<span class="lineNum">    1258 </span>            :                                                                             viewMatrix,
<span class="lineNum">    1259 </span>            :                                                                             ovalRect,
<span class="lineNum">    1260 </span><span class="lineNoCov">          0 :                                                                             style.strokeRec(),</span>
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 :                                                                             shaderCaps));</span>
<span class="lineNum">    1262 </span><span class="lineNoCov">          0 :             if (batch) {</span>
<span class="lineNum">    1263 </span><span class="lineNoCov">          0 :                 GrPipelineBuilder pipelineBuilder(paint, useHWAA);</span>
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 :                 this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">    1265 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    1266 </span>            :             }
<span class="lineNum">    1267 </span>            :         }
<span class="lineNum">    1268 </span>            :     }
<span class="lineNum">    1269 </span>            : 
<span class="lineNum">    1270 </span>            :     // Note that internalDrawPath may sw-rasterize the path into a scratch texture.
<span class="lineNum">    1271 </span>            :     // Scratch textures can be recycled after they are returned to the texture
<span class="lineNum">    1272 </span>            :     // cache. This presents a potential hazard for buffered drawing. However,
<span class="lineNum">    1273 </span>            :     // the writePixels that uploads to the scratch will perform a flush so we're
<span class="lineNum">    1274 </span>            :     // OK.
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :     this-&gt;internalDrawPath(clip, paint, viewMatrix, path, style);</span>
<span class="lineNum">    1276 </span>            : }
<span class="lineNum">    1277 </span>            : 
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 : bool GrDrawContextPriv::drawAndStencilPath(const GrClip&amp; clip,</span>
<span class="lineNum">    1279 </span>            :                                            const GrUserStencilSettings* ss,
<span class="lineNum">    1280 </span>            :                                            SkRegion::Op op,
<span class="lineNum">    1281 </span>            :                                            bool invert,
<span class="lineNum">    1282 </span>            :                                            bool doAA,
<span class="lineNum">    1283 </span>            :                                            const SkMatrix&amp; viewMatrix,
<span class="lineNum">    1284 </span>            :                                            const SkPath&amp; path) {
<span class="lineNum">    1285 </span>            :     ASSERT_SINGLE_OWNER_PRIV
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :     RETURN_FALSE_IF_ABANDONED_PRIV</span>
<span class="lineNum">    1287 </span>            :     SkDEBUGCODE(fDrawContext-&gt;validate();)
<span class="lineNum">    1288 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fDrawContext-&gt;fAuditTrail, &quot;GrDrawContext::drawPath&quot;);</span>
<span class="lineNum">    1289 </span>            : 
<span class="lineNum">    1290 </span><span class="lineNoCov">          0 :     if (path.isEmpty() &amp;&amp; path.isInverseFillType()) {</span>
<span class="lineNum">    1291 </span><span class="lineNoCov">          0 :         this-&gt;drawAndStencilRect(clip, ss, op, invert, false, SkMatrix::I(),</span>
<span class="lineNum">    1292 </span>            :                                  SkRect::MakeIWH(fDrawContext-&gt;width(),
<span class="lineNum">    1293 </span><span class="lineNoCov">          0 :                                                  fDrawContext-&gt;height()));</span>
<span class="lineNum">    1294 </span><span class="lineNoCov">          0 :         return true;</span>
<span class="lineNum">    1295 </span>            :     }
<span class="lineNum">    1296 </span>            : 
<span class="lineNum">    1297 </span><span class="lineNoCov">          0 :     AutoCheckFlush acf(fDrawContext-&gt;fDrawingManager);</span>
<span class="lineNum">    1298 </span>            : 
<span class="lineNum">    1299 </span>            :     // An Assumption here is that path renderer would use some form of tweaking
<span class="lineNum">    1300 </span>            :     // the src color (either the input alpha or in the frag shader) to implement
<span class="lineNum">    1301 </span>            :     // aa. If we have some future driver-mojo path AA that can do the right
<span class="lineNum">    1302 </span>            :     // thing WRT to the blend then we'll need some query on the PR.
<span class="lineNum">    1303 </span><span class="lineNoCov">          0 :     bool useCoverageAA = doAA &amp;&amp; !fDrawContext-&gt;isUnifiedMultisampled();</span>
<span class="lineNum">    1304 </span><span class="lineNoCov">          0 :     bool hasUserStencilSettings = !ss-&gt;isUnused();</span>
<span class="lineNum">    1305 </span><span class="lineNoCov">          0 :     bool isStencilBufferMSAA = fDrawContext-&gt;isStencilBufferMultisampled();</span>
<span class="lineNum">    1306 </span>            : 
<span class="lineNum">    1307 </span>            :     const GrPathRendererChain::DrawType type =
<span class="lineNum">    1308 </span>            :         useCoverageAA ? GrPathRendererChain::kColorAntiAlias_DrawType
<span class="lineNum">    1309 </span><span class="lineNoCov">          0 :                       : GrPathRendererChain::kColor_DrawType;</span>
<span class="lineNum">    1310 </span>            : 
<span class="lineNum">    1311 </span><span class="lineNoCov">          0 :     GrShape shape(path, GrStyle::SimpleFill());</span>
<span class="lineNum">    1312 </span>            :     GrPathRenderer::CanDrawPathArgs canDrawArgs;
<span class="lineNum">    1313 </span><span class="lineNoCov">          0 :     canDrawArgs.fShaderCaps = fDrawContext-&gt;fDrawingManager-&gt;getContext()-&gt;caps()-&gt;shaderCaps();</span>
<span class="lineNum">    1314 </span><span class="lineNoCov">          0 :     canDrawArgs.fViewMatrix = &amp;viewMatrix;</span>
<span class="lineNum">    1315 </span><span class="lineNoCov">          0 :     canDrawArgs.fShape = &amp;shape;</span>
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :     canDrawArgs.fAntiAlias = useCoverageAA;</span>
<span class="lineNum">    1317 </span><span class="lineNoCov">          0 :     canDrawArgs.fHasUserStencilSettings = hasUserStencilSettings;</span>
<span class="lineNum">    1318 </span><span class="lineNoCov">          0 :     canDrawArgs.fIsStencilBufferMSAA = isStencilBufferMSAA;</span>
<span class="lineNum">    1319 </span>            : 
<span class="lineNum">    1320 </span>            :     // Don't allow the SW renderer
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :     GrPathRenderer* pr = fDrawContext-&gt;fDrawingManager-&gt;getPathRenderer(canDrawArgs, false, type);</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 :     if (!pr) {</span>
<span class="lineNum">    1323 </span>            :         return false;
<span class="lineNum">    1324 </span>            :     }
<span class="lineNum">    1325 </span>            : 
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :     GrPaint paint;</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :     paint.setCoverageSetOpXPFactory(op, invert);</span>
<span class="lineNum">    1328 </span>            : 
<span class="lineNum">    1329 </span>            :     GrPathRenderer::DrawPathArgs args;
<span class="lineNum">    1330 </span><span class="lineNoCov">          0 :     args.fResourceProvider = fDrawContext-&gt;fDrawingManager-&gt;getContext()-&gt;resourceProvider();</span>
<span class="lineNum">    1331 </span><span class="lineNoCov">          0 :     args.fPaint = &amp;paint;</span>
<span class="lineNum">    1332 </span><span class="lineNoCov">          0 :     args.fUserStencilSettings = ss;</span>
<span class="lineNum">    1333 </span><span class="lineNoCov">          0 :     args.fDrawContext = fDrawContext;</span>
<span class="lineNum">    1334 </span><span class="lineNoCov">          0 :     args.fClip = &amp;clip;</span>
<span class="lineNum">    1335 </span><span class="lineNoCov">          0 :     args.fViewMatrix = &amp;viewMatrix;</span>
<span class="lineNum">    1336 </span><span class="lineNoCov">          0 :     args.fShape = &amp;shape;</span>
<span class="lineNum">    1337 </span><span class="lineNoCov">          0 :     args.fAntiAlias = useCoverageAA;</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">          0 :     args.fGammaCorrect = fDrawContext-&gt;isGammaCorrect();</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 :     pr-&gt;drawPath(args);</span>
<span class="lineNum">    1340 </span><span class="lineNoCov">          0 :     return true;</span>
<span class="lineNum">    1341 </span>            : }
<span class="lineNum">    1342 </span>            : 
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 : SkBudgeted GrDrawContextPriv::isBudgeted() const {</span>
<span class="lineNum">    1344 </span>            :     ASSERT_SINGLE_OWNER_PRIV
<span class="lineNum">    1345 </span>            : 
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :     if (fDrawContext-&gt;wasAbandoned()) {</span>
<span class="lineNum">    1347 </span>            :         return SkBudgeted::kNo;
<span class="lineNum">    1348 </span>            :     }
<span class="lineNum">    1349 </span>            : 
<span class="lineNum">    1350 </span>            :     SkDEBUGCODE(fDrawContext-&gt;validate();)
<span class="lineNum">    1351 </span>            : 
<span class="lineNum">    1352 </span><span class="lineNoCov">          0 :     return fDrawContext-&gt;fRenderTarget-&gt;resourcePriv().isBudgeted();</span>
<span class="lineNum">    1353 </span>            : }
<span class="lineNum">    1354 </span>            : 
<span class="lineNum">    1355 </span><span class="lineNoCov">          0 : void GrDrawContext::internalDrawPath(const GrClip&amp; clip,</span>
<span class="lineNum">    1356 </span>            :                                      const GrPaint&amp; paint,
<span class="lineNum">    1357 </span>            :                                      const SkMatrix&amp; viewMatrix,
<span class="lineNum">    1358 </span>            :                                      const SkPath&amp; path,
<span class="lineNum">    1359 </span>            :                                      const GrStyle&amp; style) {
<span class="lineNum">    1360 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">    1361 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">    1362 </span>            :     SkASSERT(!path.isEmpty());
<span class="lineNum">    1363 </span>            : 
<span class="lineNum">    1364 </span><span class="lineNoCov">          0 :     bool useCoverageAA = should_apply_coverage_aa(paint, fRenderTarget.get());</span>
<span class="lineNum">    1365 </span><span class="lineNoCov">          0 :     constexpr bool kHasUserStencilSettings = false;</span>
<span class="lineNum">    1366 </span><span class="lineNoCov">          0 :     bool isStencilBufferMSAA = this-&gt;isStencilBufferMultisampled();</span>
<span class="lineNum">    1367 </span>            : 
<span class="lineNum">    1368 </span>            :     const GrPathRendererChain::DrawType type =
<span class="lineNum">    1369 </span>            :         useCoverageAA ? GrPathRendererChain::kColorAntiAlias_DrawType
<span class="lineNum">    1370 </span><span class="lineNoCov">          0 :                       : GrPathRendererChain::kColor_DrawType;</span>
<span class="lineNum">    1371 </span>            : 
<span class="lineNum">    1372 </span><span class="lineNoCov">          0 :     GrShape shape(path, style);</span>
<span class="lineNum">    1373 </span><span class="lineNoCov">          0 :     if (shape.isEmpty()) {</span>
<span class="lineNum">    1374 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    1375 </span>            :     }
<span class="lineNum">    1376 </span>            :     GrPathRenderer::CanDrawPathArgs canDrawArgs;
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :     canDrawArgs.fShaderCaps = fDrawingManager-&gt;getContext()-&gt;caps()-&gt;shaderCaps();</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 :     canDrawArgs.fViewMatrix = &amp;viewMatrix;</span>
<span class="lineNum">    1379 </span><span class="lineNoCov">          0 :     canDrawArgs.fShape = &amp;shape;</span>
<span class="lineNum">    1380 </span><span class="lineNoCov">          0 :     canDrawArgs.fAntiAlias = useCoverageAA;</span>
<span class="lineNum">    1381 </span><span class="lineNoCov">          0 :     canDrawArgs.fHasUserStencilSettings = kHasUserStencilSettings;</span>
<span class="lineNum">    1382 </span><span class="lineNoCov">          0 :     canDrawArgs.fIsStencilBufferMSAA = isStencilBufferMSAA;</span>
<span class="lineNum">    1383 </span>            : 
<span class="lineNum">    1384 </span>            :     // Try a 1st time without applying any of the style to the geometry (and barring sw)
<span class="lineNum">    1385 </span><span class="lineNoCov">          0 :     GrPathRenderer* pr = fDrawingManager-&gt;getPathRenderer(canDrawArgs, false, type);</span>
<span class="lineNum">    1386 </span><span class="lineNoCov">          0 :     SkScalar styleScale =  GrStyle::MatrixToScaleFactor(viewMatrix);</span>
<span class="lineNum">    1387 </span>            : 
<span class="lineNum">    1388 </span><span class="lineNoCov">          0 :     if (!pr &amp;&amp; shape.style().pathEffect()) {</span>
<span class="lineNum">    1389 </span>            :         // It didn't work above, so try again with the path effect applied.
<span class="lineNum">    1390 </span><span class="lineNoCov">          0 :         shape = shape.applyStyle(GrStyle::Apply::kPathEffectOnly, styleScale);</span>
<span class="lineNum">    1391 </span><span class="lineNoCov">          0 :         if (shape.isEmpty()) {</span>
<span class="lineNum">    1392 </span>            :             return;
<span class="lineNum">    1393 </span>            :         }
<span class="lineNum">    1394 </span><span class="lineNoCov">          0 :         pr = fDrawingManager-&gt;getPathRenderer(canDrawArgs, false, type);</span>
<span class="lineNum">    1395 </span>            :     }
<span class="lineNum">    1396 </span><span class="lineNoCov">          0 :     if (!pr) {</span>
<span class="lineNum">    1397 </span><span class="lineNoCov">          0 :         if (shape.style().applies()) {</span>
<span class="lineNum">    1398 </span><span class="lineNoCov">          0 :             shape = shape.applyStyle(GrStyle::Apply::kPathEffectAndStrokeRec, styleScale);</span>
<span class="lineNum">    1399 </span><span class="lineNoCov">          0 :             if (shape.isEmpty()) {</span>
<span class="lineNum">    1400 </span>            :                 return;
<span class="lineNum">    1401 </span>            :             }
<span class="lineNum">    1402 </span>            :         }
<span class="lineNum">    1403 </span>            :         // This time, allow SW renderer
<span class="lineNum">    1404 </span><span class="lineNoCov">          0 :         pr = fDrawingManager-&gt;getPathRenderer(canDrawArgs, true, type);</span>
<span class="lineNum">    1405 </span>            :     }
<span class="lineNum">    1406 </span>            : 
<span class="lineNum">    1407 </span><span class="lineNoCov">          0 :     if (!pr) {</span>
<span class="lineNum">    1408 </span>            : #ifdef SK_DEBUG
<span class="lineNum">    1409 </span>            :         SkDebugf(&quot;Unable to find path renderer compatible with path.\n&quot;);
<span class="lineNum">    1410 </span>            : #endif
<span class="lineNum">    1411 </span>            :         return;
<span class="lineNum">    1412 </span>            :     }
<span class="lineNum">    1413 </span>            : 
<span class="lineNum">    1414 </span>            :     GrPathRenderer::DrawPathArgs args;
<span class="lineNum">    1415 </span><span class="lineNoCov">          0 :     args.fResourceProvider = fDrawingManager-&gt;getContext()-&gt;resourceProvider();</span>
<span class="lineNum">    1416 </span><span class="lineNoCov">          0 :     args.fPaint = &amp;paint;</span>
<span class="lineNum">    1417 </span><span class="lineNoCov">          0 :     args.fUserStencilSettings = &amp;GrUserStencilSettings::kUnused;</span>
<span class="lineNum">    1418 </span><span class="lineNoCov">          0 :     args.fDrawContext = this;</span>
<span class="lineNum">    1419 </span><span class="lineNoCov">          0 :     args.fClip = &amp;clip;</span>
<span class="lineNum">    1420 </span><span class="lineNoCov">          0 :     args.fViewMatrix = &amp;viewMatrix;</span>
<span class="lineNum">    1421 </span><span class="lineNoCov">          0 :     args.fShape = canDrawArgs.fShape;</span>
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 :     args.fAntiAlias = useCoverageAA;</span>
<span class="lineNum">    1423 </span><span class="lineNoCov">          0 :     args.fGammaCorrect = this-&gt;isGammaCorrect();</span>
<span class="lineNum">    1424 </span><span class="lineNoCov">          0 :     pr-&gt;drawPath(args);</span>
<a name="1425"><span class="lineNum">    1425 </span>            : }</a>
<span class="lineNum">    1426 </span>            : 
<span class="lineNum">    1427 </span><span class="lineNoCov">          0 : void GrDrawContext::drawBatch(const GrPipelineBuilder&amp; pipelineBuilder, const GrClip&amp; clip,</span>
<span class="lineNum">    1428 </span>            :                               GrDrawBatch* batch) {
<span class="lineNum">    1429 </span>            :     ASSERT_SINGLE_OWNER
<span class="lineNum">    1430 </span><span class="lineNoCov">          0 :     RETURN_IF_ABANDONED</span>
<span class="lineNum">    1431 </span>            :     SkDEBUGCODE(this-&gt;validate();)
<span class="lineNum">    1432 </span><span class="lineNoCov">          0 :     GR_AUDIT_TRAIL_AUTO_FRAME(fAuditTrail, &quot;GrDrawContext::drawBatch&quot;);</span>
<span class="lineNum">    1433 </span>            : 
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :     this-&gt;getDrawTarget()-&gt;drawBatch(pipelineBuilder, this, clip, batch);</span>
<span class="lineNum">    1435 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
