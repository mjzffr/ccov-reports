<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - output.info - security/nss/lib/freebl/ecl/curve25519_64.c</title>
  <link rel="stylesheet" type="text/css" href="../../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../../index.html">top level</a> - <a href="index.html">security/nss/lib/freebl/ecl</a> - curve25519_64.c<span style="font-size: 80%;"> (source / <a href="curve25519_64.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">output.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">292</td>
            <td class="headerCovTableEntry">292</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-04-21 12:59:10</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">12</td>
            <td class="headerCovTableEntry">12</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* This Source Code Form is subject to the terms of the Mozilla Public</a>
<span class="lineNum">       2 </span>            :  * License, v. 2.0. If a copy of the MPL was not distributed with this
<span class="lineNum">       3 </span>            :  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
<span class="lineNum">       4 </span>            : 
<span class="lineNum">       5 </span>            : /*
<span class="lineNum">       6 </span>            :  * Derived from public domain C code by Adan Langley and Daniel J. Bernstein
<span class="lineNum">       7 </span>            :  */
<span class="lineNum">       8 </span>            : 
<span class="lineNum">       9 </span>            : #include &quot;uint128.h&quot;
<span class="lineNum">      10 </span>            : 
<span class="lineNum">      11 </span>            : #include &quot;ecl-priv.h&quot;
<span class="lineNum">      12 </span>            : #include &quot;mpi.h&quot;
<span class="lineNum">      13 </span>            : 
<span class="lineNum">      14 </span>            : #include &lt;stdint.h&gt;
<span class="lineNum">      15 </span>            : #include &lt;stdio.h&gt;
<span class="lineNum">      16 </span>            : #include &lt;string.h&gt;
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span>            : typedef uint8_t u8;
<span class="lineNum">      19 </span>            : typedef uint64_t felem;
<span class="lineNum">      20 </span>            : 
<a name="21"><span class="lineNum">      21 </span>            : /* Sum two numbers: output += in */</a>
<span class="lineNum">      22 </span>            : static void
<span class="lineNum">      23 </span><span class="lineCov">          1 : fsum(felem *output, const felem *in)</span>
<span class="lineNum">      24 </span>            : {
<span class="lineNum">      25 </span>            :     unsigned i;
<span class="lineNum">      26 </span><span class="lineCov">          1 :     for (i = 0; i &lt; 5; ++i) {</span>
<span class="lineNum">      27 </span><span class="lineCov">          1 :         output[i] += in[i];</span>
<span class="lineNum">      28 </span>            :     }
<span class="lineNum">      29 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">      30 </span>            : 
<span class="lineNum">      31 </span>            : /* Find the difference of two numbers: output = in - output
<span class="lineNum">      32 </span>            :  * (note the order of the arguments!)
<a name="33"><span class="lineNum">      33 </span>            :  */</a>
<span class="lineNum">      34 </span>            : static void
<span class="lineNum">      35 </span><span class="lineCov">          1 : fdifference_backwards(felem *ioutput, const felem *iin)</span>
<span class="lineNum">      36 </span>            : {
<span class="lineNum">      37 </span>            :     static const int64_t twotothe51 = ((int64_t)1l &lt;&lt; 51);
<span class="lineNum">      38 </span><span class="lineCov">          1 :     const int64_t *in = (const int64_t *)iin;</span>
<span class="lineNum">      39 </span><span class="lineCov">          1 :     int64_t *out = (int64_t *)ioutput;</span>
<span class="lineNum">      40 </span>            : 
<span class="lineNum">      41 </span><span class="lineCov">          1 :     out[0] = in[0] - out[0];</span>
<span class="lineNum">      42 </span><span class="lineCov">          1 :     out[1] = in[1] - out[1];</span>
<span class="lineNum">      43 </span><span class="lineCov">          1 :     out[2] = in[2] - out[2];</span>
<span class="lineNum">      44 </span><span class="lineCov">          1 :     out[3] = in[3] - out[3];</span>
<span class="lineNum">      45 </span><span class="lineCov">          1 :     out[4] = in[4] - out[4];</span>
<span class="lineNum">      46 </span>            : 
<span class="lineNum">      47 </span>            :     // An arithmetic shift right of 63 places turns a positive number to 0 and a
<span class="lineNum">      48 </span>            :     // negative number to all 1's. This gives us a bitmask that lets us avoid
<span class="lineNum">      49 </span>            :     // side-channel prone branches.
<span class="lineNum">      50 </span>            :     int64_t t;
<span class="lineNum">      51 </span>            : 
<span class="lineNum">      52 </span>            : #define NEGCHAIN(a, b)        \
<span class="lineNum">      53 </span>            :     t = out[a] &gt;&gt; 63;         \
<span class="lineNum">      54 </span>            :     out[a] += twotothe51 &amp; t; \
<span class="lineNum">      55 </span>            :     out[b] -= 1 &amp; t;
<span class="lineNum">      56 </span>            : 
<span class="lineNum">      57 </span>            : #define NEGCHAIN19(a, b)      \
<span class="lineNum">      58 </span>            :     t = out[a] &gt;&gt; 63;         \
<span class="lineNum">      59 </span>            :     out[a] += twotothe51 &amp; t; \
<span class="lineNum">      60 </span>            :     out[b] -= 19 &amp; t;
<span class="lineNum">      61 </span>            : 
<span class="lineNum">      62 </span><span class="lineCov">          1 :     NEGCHAIN(0, 1);</span>
<span class="lineNum">      63 </span><span class="lineCov">          1 :     NEGCHAIN(1, 2);</span>
<span class="lineNum">      64 </span><span class="lineCov">          1 :     NEGCHAIN(2, 3);</span>
<span class="lineNum">      65 </span><span class="lineCov">          1 :     NEGCHAIN(3, 4);</span>
<span class="lineNum">      66 </span><span class="lineCov">          1 :     NEGCHAIN19(4, 0);</span>
<span class="lineNum">      67 </span><span class="lineCov">          1 :     NEGCHAIN(0, 1);</span>
<span class="lineNum">      68 </span><span class="lineCov">          1 :     NEGCHAIN(1, 2);</span>
<span class="lineNum">      69 </span><span class="lineCov">          1 :     NEGCHAIN(2, 3);</span>
<span class="lineNum">      70 </span><span class="lineCov">          1 :     NEGCHAIN(3, 4);</span>
<span class="lineNum">      71 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">      72 </span>            : 
<a name="73"><span class="lineNum">      73 </span>            : /* Multiply a number by a scalar: output = in * scalar */</a>
<span class="lineNum">      74 </span>            : static void
<span class="lineNum">      75 </span><span class="lineCov">          1 : fscalar_product(felem *output, const felem *in,</span>
<span class="lineNum">      76 </span>            :                 const felem scalar)
<span class="lineNum">      77 </span>            : {
<span class="lineNum">      78 </span>            :     uint128_t tmp, tmp2;
<span class="lineNum">      79 </span>            : 
<span class="lineNum">      80 </span><span class="lineCov">          1 :     tmp = mul6464(in[0], scalar);</span>
<span class="lineNum">      81 </span><span class="lineCov">          1 :     output[0] = mask51(tmp);</span>
<span class="lineNum">      82 </span>            : 
<span class="lineNum">      83 </span><span class="lineCov">          1 :     tmp2 = mul6464(in[1], scalar);</span>
<span class="lineNum">      84 </span><span class="lineCov">          1 :     tmp = add128(tmp2, rshift128(tmp, 51));</span>
<span class="lineNum">      85 </span><span class="lineCov">          1 :     output[1] = mask51(tmp);</span>
<span class="lineNum">      86 </span>            : 
<span class="lineNum">      87 </span><span class="lineCov">          1 :     tmp2 = mul6464(in[2], scalar);</span>
<span class="lineNum">      88 </span><span class="lineCov">          1 :     tmp = add128(tmp2, rshift128(tmp, 51));</span>
<span class="lineNum">      89 </span><span class="lineCov">          1 :     output[2] = mask51(tmp);</span>
<span class="lineNum">      90 </span>            : 
<span class="lineNum">      91 </span><span class="lineCov">          1 :     tmp2 = mul6464(in[3], scalar);</span>
<span class="lineNum">      92 </span><span class="lineCov">          1 :     tmp = add128(tmp2, rshift128(tmp, 51));</span>
<span class="lineNum">      93 </span><span class="lineCov">          1 :     output[3] = mask51(tmp);</span>
<span class="lineNum">      94 </span>            : 
<span class="lineNum">      95 </span><span class="lineCov">          1 :     tmp2 = mul6464(in[4], scalar);</span>
<span class="lineNum">      96 </span><span class="lineCov">          1 :     tmp = add128(tmp2, rshift128(tmp, 51));</span>
<span class="lineNum">      97 </span><span class="lineCov">          1 :     output[4] = mask51(tmp);</span>
<span class="lineNum">      98 </span>            : 
<span class="lineNum">      99 </span><span class="lineCov">          1 :     output[0] += mask_lower(rshift128(tmp, 51)) * 19;</span>
<span class="lineNum">     100 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     101 </span>            : 
<span class="lineNum">     102 </span>            : /* Multiply two numbers: output = in2 * in
<span class="lineNum">     103 </span>            :  *
<span class="lineNum">     104 </span>            :  * output must be distinct to both inputs. The inputs are reduced coefficient
<span class="lineNum">     105 </span>            :  * form, the output is not.
<a name="106"><span class="lineNum">     106 </span>            :  */</a>
<span class="lineNum">     107 </span>            : static void
<span class="lineNum">     108 </span><span class="lineCov">          1 : fmul(felem *output, const felem *in2, const felem *in)</span>
<span class="lineNum">     109 </span>            : {
<span class="lineNum">     110 </span>            :     uint128_t t0, t1, t2, t3, t4, t5, t6, t7, t8;
<span class="lineNum">     111 </span>            : 
<span class="lineNum">     112 </span><span class="lineCov">          1 :     t0 = mul6464(in[0], in2[0]);</span>
<span class="lineNum">     113 </span><span class="lineCov">          1 :     t1 = add128(mul6464(in[1], in2[0]), mul6464(in[0], in2[1]));</span>
<span class="lineNum">     114 </span><span class="lineCov">          1 :     t2 = add128(add128(mul6464(in[0], in2[2]),</span>
<span class="lineNum">     115 </span>            :                        mul6464(in[2], in2[0])),
<span class="lineNum">     116 </span>            :                 mul6464(in[1], in2[1]));
<span class="lineNum">     117 </span><span class="lineCov">          1 :     t3 = add128(add128(add128(mul6464(in[0], in2[3]),</span>
<span class="lineNum">     118 </span>            :                               mul6464(in[3], in2[0])),
<span class="lineNum">     119 </span>            :                        mul6464(in[1], in2[2])),
<span class="lineNum">     120 </span>            :                 mul6464(in[2], in2[1]));
<span class="lineNum">     121 </span><span class="lineCov">          1 :     t4 = add128(add128(add128(add128(mul6464(in[0], in2[4]),</span>
<span class="lineNum">     122 </span>            :                                      mul6464(in[4], in2[0])),
<span class="lineNum">     123 </span>            :                               mul6464(in[3], in2[1])),
<span class="lineNum">     124 </span>            :                        mul6464(in[1], in2[3])),
<span class="lineNum">     125 </span>            :                 mul6464(in[2], in2[2]));
<span class="lineNum">     126 </span><span class="lineCov">          1 :     t5 = add128(add128(add128(mul6464(in[4], in2[1]),</span>
<span class="lineNum">     127 </span>            :                               mul6464(in[1], in2[4])),
<span class="lineNum">     128 </span>            :                        mul6464(in[2], in2[3])),
<span class="lineNum">     129 </span>            :                 mul6464(in[3], in2[2]));
<span class="lineNum">     130 </span><span class="lineCov">          1 :     t6 = add128(add128(mul6464(in[4], in2[2]),</span>
<span class="lineNum">     131 </span>            :                        mul6464(in[2], in2[4])),
<span class="lineNum">     132 </span>            :                 mul6464(in[3], in2[3]));
<span class="lineNum">     133 </span><span class="lineCov">          1 :     t7 = add128(mul6464(in[3], in2[4]), mul6464(in[4], in2[3]));</span>
<span class="lineNum">     134 </span><span class="lineCov">          1 :     t8 = mul6464(in[4], in2[4]);</span>
<span class="lineNum">     135 </span>            : 
<span class="lineNum">     136 </span><span class="lineCov">          1 :     t0 = add128(t0, mul12819(t5));</span>
<span class="lineNum">     137 </span><span class="lineCov">          1 :     t1 = add128(t1, mul12819(t6));</span>
<span class="lineNum">     138 </span><span class="lineCov">          1 :     t2 = add128(t2, mul12819(t7));</span>
<span class="lineNum">     139 </span><span class="lineCov">          1 :     t3 = add128(t3, mul12819(t8));</span>
<span class="lineNum">     140 </span>            : 
<span class="lineNum">     141 </span><span class="lineCov">          1 :     t1 = add128(t1, rshift128(t0, 51));</span>
<span class="lineNum">     142 </span><span class="lineCov">          1 :     t0 = mask51full(t0);</span>
<span class="lineNum">     143 </span><span class="lineCov">          1 :     t2 = add128(t2, rshift128(t1, 51));</span>
<span class="lineNum">     144 </span><span class="lineCov">          1 :     t1 = mask51full(t1);</span>
<span class="lineNum">     145 </span><span class="lineCov">          1 :     t3 = add128(t3, rshift128(t2, 51));</span>
<span class="lineNum">     146 </span><span class="lineCov">          1 :     t4 = add128(t4, rshift128(t3, 51));</span>
<span class="lineNum">     147 </span><span class="lineCov">          1 :     t0 = add128(t0, mul12819(rshift128(t4, 51)));</span>
<span class="lineNum">     148 </span><span class="lineCov">          1 :     t1 = add128(t1, rshift128(t0, 51));</span>
<span class="lineNum">     149 </span><span class="lineCov">          1 :     t2 = mask51full(t2);</span>
<span class="lineNum">     150 </span><span class="lineCov">          1 :     t2 = add128(t2, rshift128(t1, 51));</span>
<span class="lineNum">     151 </span>            : 
<span class="lineNum">     152 </span><span class="lineCov">          1 :     output[0] = mask51(t0);</span>
<span class="lineNum">     153 </span><span class="lineCov">          1 :     output[1] = mask51(t1);</span>
<span class="lineNum">     154 </span><span class="lineCov">          1 :     output[2] = mask_lower(t2);</span>
<span class="lineNum">     155 </span><span class="lineCov">          1 :     output[3] = mask51(t3);</span>
<span class="lineNum">     156 </span><span class="lineCov">          1 :     output[4] = mask51(t4);</span>
<span class="lineNum">     157 </span><span class="lineCov">          1 : }</span>
<a name="158"><span class="lineNum">     158 </span>            : </a>
<span class="lineNum">     159 </span>            : static void
<span class="lineNum">     160 </span><span class="lineCov">          1 : fsquare(felem *output, const felem *in)</span>
<span class="lineNum">     161 </span>            : {
<span class="lineNum">     162 </span>            :     uint128_t t0, t1, t2, t3, t4, t5, t6, t7, t8;
<span class="lineNum">     163 </span>            : 
<span class="lineNum">     164 </span><span class="lineCov">          1 :     t0 = mul6464(in[0], in[0]);</span>
<span class="lineNum">     165 </span><span class="lineCov">          1 :     t1 = lshift128(mul6464(in[0], in[1]), 1);</span>
<span class="lineNum">     166 </span><span class="lineCov">          1 :     t2 = add128(lshift128(mul6464(in[0], in[2]), 1),</span>
<span class="lineNum">     167 </span>            :                 mul6464(in[1], in[1]));
<span class="lineNum">     168 </span><span class="lineCov">          1 :     t3 = add128(lshift128(mul6464(in[0], in[3]), 1),</span>
<span class="lineNum">     169 </span>            :                 lshift128(mul6464(in[1], in[2]), 1));
<span class="lineNum">     170 </span><span class="lineCov">          1 :     t4 = add128(add128(lshift128(mul6464(in[0], in[4]), 1),</span>
<span class="lineNum">     171 </span>            :                        lshift128(mul6464(in[3], in[1]), 1)),
<span class="lineNum">     172 </span>            :                 mul6464(in[2], in[2]));
<span class="lineNum">     173 </span><span class="lineCov">          1 :     t5 = add128(lshift128(mul6464(in[4], in[1]), 1),</span>
<span class="lineNum">     174 </span>            :                 lshift128(mul6464(in[2], in[3]), 1));
<span class="lineNum">     175 </span><span class="lineCov">          1 :     t6 = add128(lshift128(mul6464(in[4], in[2]), 1),</span>
<span class="lineNum">     176 </span>            :                 mul6464(in[3], in[3]));
<span class="lineNum">     177 </span><span class="lineCov">          1 :     t7 = lshift128(mul6464(in[3], in[4]), 1);</span>
<span class="lineNum">     178 </span><span class="lineCov">          1 :     t8 = mul6464(in[4], in[4]);</span>
<span class="lineNum">     179 </span>            : 
<span class="lineNum">     180 </span><span class="lineCov">          1 :     t0 = add128(t0, mul12819(t5));</span>
<span class="lineNum">     181 </span><span class="lineCov">          1 :     t1 = add128(t1, mul12819(t6));</span>
<span class="lineNum">     182 </span><span class="lineCov">          1 :     t2 = add128(t2, mul12819(t7));</span>
<span class="lineNum">     183 </span><span class="lineCov">          1 :     t3 = add128(t3, mul12819(t8));</span>
<span class="lineNum">     184 </span>            : 
<span class="lineNum">     185 </span><span class="lineCov">          1 :     t1 = add128(t1, rshift128(t0, 51));</span>
<span class="lineNum">     186 </span><span class="lineCov">          1 :     t0 = mask51full(t0);</span>
<span class="lineNum">     187 </span><span class="lineCov">          1 :     t2 = add128(t2, rshift128(t1, 51));</span>
<span class="lineNum">     188 </span><span class="lineCov">          1 :     t1 = mask51full(t1);</span>
<span class="lineNum">     189 </span><span class="lineCov">          1 :     t3 = add128(t3, rshift128(t2, 51));</span>
<span class="lineNum">     190 </span><span class="lineCov">          1 :     t4 = add128(t4, rshift128(t3, 51));</span>
<span class="lineNum">     191 </span><span class="lineCov">          1 :     t0 = add128(t0, mul12819(rshift128(t4, 51)));</span>
<span class="lineNum">     192 </span><span class="lineCov">          1 :     t1 = add128(t1, rshift128(t0, 51));</span>
<span class="lineNum">     193 </span>            : 
<span class="lineNum">     194 </span><span class="lineCov">          1 :     output[0] = mask51(t0);</span>
<span class="lineNum">     195 </span><span class="lineCov">          1 :     output[1] = mask_lower(t1);</span>
<span class="lineNum">     196 </span><span class="lineCov">          1 :     output[2] = mask51(t2);</span>
<span class="lineNum">     197 </span><span class="lineCov">          1 :     output[3] = mask51(t3);</span>
<span class="lineNum">     198 </span><span class="lineCov">          1 :     output[4] = mask51(t4);</span>
<span class="lineNum">     199 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     200 </span>            : 
<a name="201"><span class="lineNum">     201 </span>            : /* Take a 32-byte number and expand it into polynomial form */</a>
<span class="lineNum">     202 </span>            : static void NO_SANITIZE_ALIGNMENT
<span class="lineNum">     203 </span><span class="lineCov">          1 : fexpand(felem *output, const u8 *in)</span>
<span class="lineNum">     204 </span>            : {
<span class="lineNum">     205 </span><span class="lineCov">          1 :     output[0] = *((const uint64_t *)(in)) &amp; MASK51;</span>
<span class="lineNum">     206 </span><span class="lineCov">          1 :     output[1] = (*((const uint64_t *)(in + 6)) &gt;&gt; 3) &amp; MASK51;</span>
<span class="lineNum">     207 </span><span class="lineCov">          1 :     output[2] = (*((const uint64_t *)(in + 12)) &gt;&gt; 6) &amp; MASK51;</span>
<span class="lineNum">     208 </span><span class="lineCov">          1 :     output[3] = (*((const uint64_t *)(in + 19)) &gt;&gt; 1) &amp; MASK51;</span>
<span class="lineNum">     209 </span><span class="lineCov">          1 :     output[4] = (*((const uint64_t *)(in + 24)) &gt;&gt; 12) &amp; MASK51;</span>
<span class="lineNum">     210 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     211 </span>            : 
<span class="lineNum">     212 </span>            : /* Take a fully reduced polynomial form number and contract it into a
<span class="lineNum">     213 </span>            :  * 32-byte array
<a name="214"><span class="lineNum">     214 </span>            :  */</a>
<span class="lineNum">     215 </span>            : static void
<span class="lineNum">     216 </span><span class="lineCov">          1 : fcontract(u8 *output, const felem *input)</span>
<span class="lineNum">     217 </span>            : {
<span class="lineNum">     218 </span><span class="lineCov">          1 :     uint128_t t0 = init128x(input[0]);</span>
<span class="lineNum">     219 </span><span class="lineCov">          1 :     uint128_t t1 = init128x(input[1]);</span>
<span class="lineNum">     220 </span><span class="lineCov">          1 :     uint128_t t2 = init128x(input[2]);</span>
<span class="lineNum">     221 </span><span class="lineCov">          1 :     uint128_t t3 = init128x(input[3]);</span>
<span class="lineNum">     222 </span><span class="lineCov">          1 :     uint128_t t4 = init128x(input[4]);</span>
<span class="lineNum">     223 </span><span class="lineCov">          1 :     uint128_t tmp = init128x(19);</span>
<span class="lineNum">     224 </span>            : 
<span class="lineNum">     225 </span><span class="lineCov">          1 :     t1 = add128(t1, rshift128(t0, 51));</span>
<span class="lineNum">     226 </span><span class="lineCov">          1 :     t0 = mask51full(t0);</span>
<span class="lineNum">     227 </span><span class="lineCov">          1 :     t2 = add128(t2, rshift128(t1, 51));</span>
<span class="lineNum">     228 </span><span class="lineCov">          1 :     t1 = mask51full(t1);</span>
<span class="lineNum">     229 </span><span class="lineCov">          1 :     t3 = add128(t3, rshift128(t2, 51));</span>
<span class="lineNum">     230 </span><span class="lineCov">          1 :     t2 = mask51full(t2);</span>
<span class="lineNum">     231 </span><span class="lineCov">          1 :     t4 = add128(t4, rshift128(t3, 51));</span>
<span class="lineNum">     232 </span><span class="lineCov">          1 :     t3 = mask51full(t3);</span>
<span class="lineNum">     233 </span><span class="lineCov">          1 :     t0 = add128(t0, mul12819(rshift128(t4, 51)));</span>
<span class="lineNum">     234 </span><span class="lineCov">          1 :     t4 = mask51full(t4);</span>
<span class="lineNum">     235 </span>            : 
<span class="lineNum">     236 </span><span class="lineCov">          1 :     t1 = add128(t1, rshift128(t0, 51));</span>
<span class="lineNum">     237 </span><span class="lineCov">          1 :     t0 = mask51full(t0);</span>
<span class="lineNum">     238 </span><span class="lineCov">          1 :     t2 = add128(t2, rshift128(t1, 51));</span>
<span class="lineNum">     239 </span><span class="lineCov">          1 :     t1 = mask51full(t1);</span>
<span class="lineNum">     240 </span><span class="lineCov">          1 :     t3 = add128(t3, rshift128(t2, 51));</span>
<span class="lineNum">     241 </span><span class="lineCov">          1 :     t2 = mask51full(t2);</span>
<span class="lineNum">     242 </span><span class="lineCov">          1 :     t4 = add128(t4, rshift128(t3, 51));</span>
<span class="lineNum">     243 </span><span class="lineCov">          1 :     t3 = mask51full(t3);</span>
<span class="lineNum">     244 </span><span class="lineCov">          1 :     t0 = add128(t0, mul12819(rshift128(t4, 51)));</span>
<span class="lineNum">     245 </span><span class="lineCov">          1 :     t4 = mask51full(t4);</span>
<span class="lineNum">     246 </span>            : 
<span class="lineNum">     247 </span>            :     /* now t is between 0 and 2^255-1, properly carried. */
<span class="lineNum">     248 </span>            :     /* case 1: between 0 and 2^255-20. case 2: between 2^255-19 and 2^255-1. */
<span class="lineNum">     249 </span>            : 
<span class="lineNum">     250 </span><span class="lineCov">          1 :     t0 = add128(t0, tmp);</span>
<span class="lineNum">     251 </span>            : 
<span class="lineNum">     252 </span><span class="lineCov">          1 :     t1 = add128(t1, rshift128(t0, 51));</span>
<span class="lineNum">     253 </span><span class="lineCov">          1 :     t0 = mask51full(t0);</span>
<span class="lineNum">     254 </span><span class="lineCov">          1 :     t2 = add128(t2, rshift128(t1, 51));</span>
<span class="lineNum">     255 </span><span class="lineCov">          1 :     t1 = mask51full(t1);</span>
<span class="lineNum">     256 </span><span class="lineCov">          1 :     t3 = add128(t3, rshift128(t2, 51));</span>
<span class="lineNum">     257 </span><span class="lineCov">          1 :     t2 = mask51full(t2);</span>
<span class="lineNum">     258 </span><span class="lineCov">          1 :     t4 = add128(t4, rshift128(t3, 51));</span>
<span class="lineNum">     259 </span><span class="lineCov">          1 :     t3 = mask51full(t3);</span>
<span class="lineNum">     260 </span><span class="lineCov">          1 :     t0 = add128(t0, mul12819(rshift128(t4, 51)));</span>
<span class="lineNum">     261 </span><span class="lineCov">          1 :     t4 = mask51full(t4);</span>
<span class="lineNum">     262 </span>            : 
<span class="lineNum">     263 </span>            :     /* now between 19 and 2^255-1 in both cases, and offset by 19. */
<span class="lineNum">     264 </span>            : 
<span class="lineNum">     265 </span><span class="lineCov">          1 :     t0 = add128(t0, init128x(0x8000000000000 - 19));</span>
<span class="lineNum">     266 </span><span class="lineCov">          1 :     tmp = init128x(0x8000000000000 - 1);</span>
<span class="lineNum">     267 </span><span class="lineCov">          1 :     t1 = add128(t1, tmp);</span>
<span class="lineNum">     268 </span><span class="lineCov">          1 :     t2 = add128(t2, tmp);</span>
<span class="lineNum">     269 </span><span class="lineCov">          1 :     t3 = add128(t3, tmp);</span>
<span class="lineNum">     270 </span><span class="lineCov">          1 :     t4 = add128(t4, tmp);</span>
<span class="lineNum">     271 </span>            : 
<span class="lineNum">     272 </span>            :     /* now between 2^255 and 2^256-20, and offset by 2^255. */
<span class="lineNum">     273 </span>            : 
<span class="lineNum">     274 </span><span class="lineCov">          1 :     t1 = add128(t1, rshift128(t0, 51));</span>
<span class="lineNum">     275 </span><span class="lineCov">          1 :     t0 = mask51full(t0);</span>
<span class="lineNum">     276 </span><span class="lineCov">          1 :     t2 = add128(t2, rshift128(t1, 51));</span>
<span class="lineNum">     277 </span><span class="lineCov">          1 :     t1 = mask51full(t1);</span>
<span class="lineNum">     278 </span><span class="lineCov">          1 :     t3 = add128(t3, rshift128(t2, 51));</span>
<span class="lineNum">     279 </span><span class="lineCov">          1 :     t2 = mask51full(t2);</span>
<span class="lineNum">     280 </span><span class="lineCov">          1 :     t4 = add128(t4, rshift128(t3, 51));</span>
<span class="lineNum">     281 </span><span class="lineCov">          1 :     t3 = mask51full(t3);</span>
<span class="lineNum">     282 </span><span class="lineCov">          1 :     t4 = mask51full(t4);</span>
<span class="lineNum">     283 </span>            : 
<span class="lineNum">     284 </span><span class="lineCov">          1 :     *((uint64_t *)(output)) = mask_lower(t0) | mask_lower(t1) &lt;&lt; 51;</span>
<span class="lineNum">     285 </span><span class="lineCov">          1 :     *((uint64_t *)(output + 8)) = (mask_lower(t1) &gt;&gt; 13) | (mask_lower(t2) &lt;&lt; 38);</span>
<span class="lineNum">     286 </span><span class="lineCov">          1 :     *((uint64_t *)(output + 16)) = (mask_lower(t2) &gt;&gt; 26) | (mask_lower(t3) &lt;&lt; 25);</span>
<span class="lineNum">     287 </span><span class="lineCov">          1 :     *((uint64_t *)(output + 24)) = (mask_lower(t3) &gt;&gt; 39) | (mask_lower(t4) &lt;&lt; 12);</span>
<span class="lineNum">     288 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     289 </span>            : 
<span class="lineNum">     290 </span>            : /* Input: Q, Q', Q-Q'
<span class="lineNum">     291 </span>            :  * Output: 2Q, Q+Q'
<span class="lineNum">     292 </span>            :  *
<span class="lineNum">     293 </span>            :  *   x2 z3: long form
<span class="lineNum">     294 </span>            :  *   x3 z3: long form
<span class="lineNum">     295 </span>            :  *   x z: short form, destroyed
<span class="lineNum">     296 </span>            :  *   xprime zprime: short form, destroyed
<span class="lineNum">     297 </span>            :  *   qmqp: short form, preserved
<a name="298"><span class="lineNum">     298 </span>            :  */</a>
<span class="lineNum">     299 </span>            : static void
<span class="lineNum">     300 </span><span class="lineCov">          1 : fmonty(felem *x2, felem *z2,         /* output 2Q */</span>
<span class="lineNum">     301 </span>            :        felem *x3, felem *z3,         /* output Q + Q' */
<span class="lineNum">     302 </span>            :        felem *x, felem *z,           /* input Q */
<span class="lineNum">     303 </span>            :        felem *xprime, felem *zprime, /* input Q' */
<span class="lineNum">     304 </span>            :        const felem *qmqp /* input Q - Q' */)
<span class="lineNum">     305 </span>            : {
<span class="lineNum">     306 </span>            :     felem origx[5], origxprime[5], zzz[5], xx[5], zz[5], xxprime[5], zzprime[5],
<span class="lineNum">     307 </span>            :         zzzprime[5];
<span class="lineNum">     308 </span>            : 
<span class="lineNum">     309 </span><span class="lineCov">          1 :     memcpy(origx, x, 5 * sizeof(felem));</span>
<span class="lineNum">     310 </span><span class="lineCov">          1 :     fsum(x, z);</span>
<span class="lineNum">     311 </span><span class="lineCov">          1 :     fdifference_backwards(z, origx); // does x - z</span>
<span class="lineNum">     312 </span>            : 
<span class="lineNum">     313 </span><span class="lineCov">          1 :     memcpy(origxprime, xprime, sizeof(felem) * 5);</span>
<span class="lineNum">     314 </span><span class="lineCov">          1 :     fsum(xprime, zprime);</span>
<span class="lineNum">     315 </span><span class="lineCov">          1 :     fdifference_backwards(zprime, origxprime);</span>
<span class="lineNum">     316 </span><span class="lineCov">          1 :     fmul(xxprime, xprime, z);</span>
<span class="lineNum">     317 </span><span class="lineCov">          1 :     fmul(zzprime, x, zprime);</span>
<span class="lineNum">     318 </span><span class="lineCov">          1 :     memcpy(origxprime, xxprime, sizeof(felem) * 5);</span>
<span class="lineNum">     319 </span><span class="lineCov">          1 :     fsum(xxprime, zzprime);</span>
<span class="lineNum">     320 </span><span class="lineCov">          1 :     fdifference_backwards(zzprime, origxprime);</span>
<span class="lineNum">     321 </span><span class="lineCov">          1 :     fsquare(x3, xxprime);</span>
<span class="lineNum">     322 </span><span class="lineCov">          1 :     fsquare(zzzprime, zzprime);</span>
<span class="lineNum">     323 </span><span class="lineCov">          1 :     fmul(z3, zzzprime, qmqp);</span>
<span class="lineNum">     324 </span>            : 
<span class="lineNum">     325 </span><span class="lineCov">          1 :     fsquare(xx, x);</span>
<span class="lineNum">     326 </span><span class="lineCov">          1 :     fsquare(zz, z);</span>
<span class="lineNum">     327 </span><span class="lineCov">          1 :     fmul(x2, xx, zz);</span>
<span class="lineNum">     328 </span><span class="lineCov">          1 :     fdifference_backwards(zz, xx); // does zz = xx - zz</span>
<span class="lineNum">     329 </span><span class="lineCov">          1 :     fscalar_product(zzz, zz, 121665);</span>
<span class="lineNum">     330 </span><span class="lineCov">          1 :     fsum(zzz, xx);</span>
<span class="lineNum">     331 </span><span class="lineCov">          1 :     fmul(z2, zz, zzz);</span>
<span class="lineNum">     332 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     333 </span>            : 
<span class="lineNum">     334 </span>            : // -----------------------------------------------------------------------------
<span class="lineNum">     335 </span>            : // Maybe swap the contents of two felem arrays (@a and @b), each @len elements
<span class="lineNum">     336 </span>            : // long. Perform the swap iff @swap is non-zero.
<span class="lineNum">     337 </span>            : //
<span class="lineNum">     338 </span>            : // This function performs the swap without leaking any side-channel
<span class="lineNum">     339 </span>            : // information.
<a name="340"><span class="lineNum">     340 </span>            : // -----------------------------------------------------------------------------</a>
<span class="lineNum">     341 </span>            : static void
<span class="lineNum">     342 </span><span class="lineCov">          1 : swap_conditional(felem *a, felem *b, unsigned len, felem iswap)</span>
<span class="lineNum">     343 </span>            : {
<span class="lineNum">     344 </span>            :     unsigned i;
<span class="lineNum">     345 </span><span class="lineCov">          1 :     const felem swap = 1 + ~iswap;</span>
<span class="lineNum">     346 </span>            : 
<span class="lineNum">     347 </span><span class="lineCov">          1 :     for (i = 0; i &lt; len; ++i) {</span>
<span class="lineNum">     348 </span><span class="lineCov">          1 :         const felem x = swap &amp; (a[i] ^ b[i]);</span>
<span class="lineNum">     349 </span><span class="lineCov">          1 :         a[i] ^= x;</span>
<span class="lineNum">     350 </span><span class="lineCov">          1 :         b[i] ^= x;</span>
<span class="lineNum">     351 </span>            :     }
<span class="lineNum">     352 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     353 </span>            : 
<span class="lineNum">     354 </span>            : /* Calculates nQ where Q is the x-coordinate of a point on the curve
<span class="lineNum">     355 </span>            :  *
<span class="lineNum">     356 </span>            :  *   resultx/resultz: the x coordinate of the resulting curve point (short form)
<span class="lineNum">     357 </span>            :  *   n: a 32-byte number
<span class="lineNum">     358 </span>            :  *   q: a point of the curve (short form)
<a name="359"><span class="lineNum">     359 </span>            :  */</a>
<span class="lineNum">     360 </span>            : static void
<span class="lineNum">     361 </span><span class="lineCov">          1 : cmult(felem *resultx, felem *resultz, const u8 *n, const felem *q)</span>
<span class="lineNum">     362 </span>            : {
<span class="lineNum">     363 </span><span class="lineCov">          1 :     felem a[5] = { 0 }, b[5] = { 1 }, c[5] = { 1 }, d[5] = { 0 };</span>
<span class="lineNum">     364 </span><span class="lineCov">          1 :     felem *nqpqx = a, *nqpqz = b, *nqx = c, *nqz = d, *t;</span>
<span class="lineNum">     365 </span><span class="lineCov">          1 :     felem e[5] = { 0 }, f[5] = { 1 }, g[5] = { 0 }, h[5] = { 1 };</span>
<span class="lineNum">     366 </span><span class="lineCov">          1 :     felem *nqpqx2 = e, *nqpqz2 = f, *nqx2 = g, *nqz2 = h;</span>
<span class="lineNum">     367 </span>            : 
<span class="lineNum">     368 </span>            :     unsigned i, j;
<span class="lineNum">     369 </span>            : 
<span class="lineNum">     370 </span><span class="lineCov">          1 :     memcpy(nqpqx, q, sizeof(felem) * 5);</span>
<span class="lineNum">     371 </span>            : 
<span class="lineNum">     372 </span><span class="lineCov">          1 :     for (i = 0; i &lt; 32; ++i) {</span>
<span class="lineNum">     373 </span><span class="lineCov">          1 :         u8 byte = n[31 - i];</span>
<span class="lineNum">     374 </span><span class="lineCov">          1 :         for (j = 0; j &lt; 8; ++j) {</span>
<span class="lineNum">     375 </span><span class="lineCov">          1 :             const felem bit = byte &gt;&gt; 7;</span>
<span class="lineNum">     376 </span>            : 
<span class="lineNum">     377 </span><span class="lineCov">          1 :             swap_conditional(nqx, nqpqx, 5, bit);</span>
<span class="lineNum">     378 </span><span class="lineCov">          1 :             swap_conditional(nqz, nqpqz, 5, bit);</span>
<span class="lineNum">     379 </span><span class="lineCov">          1 :             fmonty(nqx2, nqz2, nqpqx2, nqpqz2, nqx, nqz, nqpqx, nqpqz, q);</span>
<span class="lineNum">     380 </span><span class="lineCov">          1 :             swap_conditional(nqx2, nqpqx2, 5, bit);</span>
<span class="lineNum">     381 </span><span class="lineCov">          1 :             swap_conditional(nqz2, nqpqz2, 5, bit);</span>
<span class="lineNum">     382 </span>            : 
<span class="lineNum">     383 </span><span class="lineCov">          1 :             t = nqx;</span>
<span class="lineNum">     384 </span><span class="lineCov">          1 :             nqx = nqx2;</span>
<span class="lineNum">     385 </span><span class="lineCov">          1 :             nqx2 = t;</span>
<span class="lineNum">     386 </span><span class="lineCov">          1 :             t = nqz;</span>
<span class="lineNum">     387 </span><span class="lineCov">          1 :             nqz = nqz2;</span>
<span class="lineNum">     388 </span><span class="lineCov">          1 :             nqz2 = t;</span>
<span class="lineNum">     389 </span><span class="lineCov">          1 :             t = nqpqx;</span>
<span class="lineNum">     390 </span><span class="lineCov">          1 :             nqpqx = nqpqx2;</span>
<span class="lineNum">     391 </span><span class="lineCov">          1 :             nqpqx2 = t;</span>
<span class="lineNum">     392 </span><span class="lineCov">          1 :             t = nqpqz;</span>
<span class="lineNum">     393 </span><span class="lineCov">          1 :             nqpqz = nqpqz2;</span>
<span class="lineNum">     394 </span><span class="lineCov">          1 :             nqpqz2 = t;</span>
<span class="lineNum">     395 </span>            : 
<span class="lineNum">     396 </span><span class="lineCov">          1 :             byte &lt;&lt;= 1;</span>
<span class="lineNum">     397 </span>            :         }
<span class="lineNum">     398 </span>            :     }
<span class="lineNum">     399 </span>            : 
<span class="lineNum">     400 </span><span class="lineCov">          1 :     memcpy(resultx, nqx, sizeof(felem) * 5);</span>
<span class="lineNum">     401 </span><span class="lineCov">          1 :     memcpy(resultz, nqz, sizeof(felem) * 5);</span>
<span class="lineNum">     402 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     403 </span>            : 
<span class="lineNum">     404 </span>            : // -----------------------------------------------------------------------------
<span class="lineNum">     405 </span>            : // Shamelessly copied from djb's code
<a name="406"><span class="lineNum">     406 </span>            : // -----------------------------------------------------------------------------</a>
<span class="lineNum">     407 </span>            : static void
<span class="lineNum">     408 </span><span class="lineCov">          1 : crecip(felem *out, const felem *z)</span>
<span class="lineNum">     409 </span>            : {
<span class="lineNum">     410 </span>            :     felem z2[5];
<span class="lineNum">     411 </span>            :     felem z9[5];
<span class="lineNum">     412 </span>            :     felem z11[5];
<span class="lineNum">     413 </span>            :     felem z2_5_0[5];
<span class="lineNum">     414 </span>            :     felem z2_10_0[5];
<span class="lineNum">     415 </span>            :     felem z2_20_0[5];
<span class="lineNum">     416 </span>            :     felem z2_50_0[5];
<span class="lineNum">     417 </span>            :     felem z2_100_0[5];
<span class="lineNum">     418 </span>            :     felem t0[5];
<span class="lineNum">     419 </span>            :     felem t1[5];
<span class="lineNum">     420 </span>            :     int i;
<span class="lineNum">     421 </span>            : 
<span class="lineNum">     422 </span><span class="lineCov">          1 :     /* 2 */ fsquare(z2, z);</span>
<span class="lineNum">     423 </span><span class="lineCov">          1 :     /* 4 */ fsquare(t1, z2);</span>
<span class="lineNum">     424 </span><span class="lineCov">          1 :     /* 8 */ fsquare(t0, t1);</span>
<span class="lineNum">     425 </span><span class="lineCov">          1 :     /* 9 */ fmul(z9, t0, z);</span>
<span class="lineNum">     426 </span><span class="lineCov">          1 :     /* 11 */ fmul(z11, z9, z2);</span>
<span class="lineNum">     427 </span><span class="lineCov">          1 :     /* 22 */ fsquare(t0, z11);</span>
<span class="lineNum">     428 </span><span class="lineCov">          1 :     /* 2^5 - 2^0 = 31 */ fmul(z2_5_0, t0, z9);</span>
<span class="lineNum">     429 </span>            : 
<span class="lineNum">     430 </span><span class="lineCov">          1 :     /* 2^6 - 2^1 */ fsquare(t0, z2_5_0);</span>
<span class="lineNum">     431 </span><span class="lineCov">          1 :     /* 2^7 - 2^2 */ fsquare(t1, t0);</span>
<span class="lineNum">     432 </span><span class="lineCov">          1 :     /* 2^8 - 2^3 */ fsquare(t0, t1);</span>
<span class="lineNum">     433 </span><span class="lineCov">          1 :     /* 2^9 - 2^4 */ fsquare(t1, t0);</span>
<span class="lineNum">     434 </span><span class="lineCov">          1 :     /* 2^10 - 2^5 */ fsquare(t0, t1);</span>
<span class="lineNum">     435 </span><span class="lineCov">          1 :     /* 2^10 - 2^0 */ fmul(z2_10_0, t0, z2_5_0);</span>
<span class="lineNum">     436 </span>            : 
<span class="lineNum">     437 </span><span class="lineCov">          1 :     /* 2^11 - 2^1 */ fsquare(t0, z2_10_0);</span>
<span class="lineNum">     438 </span><span class="lineCov">          1 :     /* 2^12 - 2^2 */ fsquare(t1, t0);</span>
<span class="lineNum">     439 </span><span class="lineCov">          1 :     /* 2^20 - 2^10 */ for (i = 2; i &lt; 10; i += 2) {</span>
<span class="lineNum">     440 </span><span class="lineCov">          1 :         fsquare(t0, t1);</span>
<span class="lineNum">     441 </span><span class="lineCov">          1 :         fsquare(t1, t0);</span>
<span class="lineNum">     442 </span>            :     }
<span class="lineNum">     443 </span><span class="lineCov">          1 :     /* 2^20 - 2^0 */ fmul(z2_20_0, t1, z2_10_0);</span>
<span class="lineNum">     444 </span>            : 
<span class="lineNum">     445 </span><span class="lineCov">          1 :     /* 2^21 - 2^1 */ fsquare(t0, z2_20_0);</span>
<span class="lineNum">     446 </span><span class="lineCov">          1 :     /* 2^22 - 2^2 */ fsquare(t1, t0);</span>
<span class="lineNum">     447 </span><span class="lineCov">          1 :     /* 2^40 - 2^20 */ for (i = 2; i &lt; 20; i += 2) {</span>
<span class="lineNum">     448 </span><span class="lineCov">          1 :         fsquare(t0, t1);</span>
<span class="lineNum">     449 </span><span class="lineCov">          1 :         fsquare(t1, t0);</span>
<span class="lineNum">     450 </span>            :     }
<span class="lineNum">     451 </span><span class="lineCov">          1 :     /* 2^40 - 2^0 */ fmul(t0, t1, z2_20_0);</span>
<span class="lineNum">     452 </span>            : 
<span class="lineNum">     453 </span><span class="lineCov">          1 :     /* 2^41 - 2^1 */ fsquare(t1, t0);</span>
<span class="lineNum">     454 </span><span class="lineCov">          1 :     /* 2^42 - 2^2 */ fsquare(t0, t1);</span>
<span class="lineNum">     455 </span><span class="lineCov">          1 :     /* 2^50 - 2^10 */ for (i = 2; i &lt; 10; i += 2) {</span>
<span class="lineNum">     456 </span><span class="lineCov">          1 :         fsquare(t1, t0);</span>
<span class="lineNum">     457 </span><span class="lineCov">          1 :         fsquare(t0, t1);</span>
<span class="lineNum">     458 </span>            :     }
<span class="lineNum">     459 </span><span class="lineCov">          1 :     /* 2^50 - 2^0 */ fmul(z2_50_0, t0, z2_10_0);</span>
<span class="lineNum">     460 </span>            : 
<span class="lineNum">     461 </span><span class="lineCov">          1 :     /* 2^51 - 2^1 */ fsquare(t0, z2_50_0);</span>
<span class="lineNum">     462 </span><span class="lineCov">          1 :     /* 2^52 - 2^2 */ fsquare(t1, t0);</span>
<span class="lineNum">     463 </span><span class="lineCov">          1 :     /* 2^100 - 2^50 */ for (i = 2; i &lt; 50; i += 2) {</span>
<span class="lineNum">     464 </span><span class="lineCov">          1 :         fsquare(t0, t1);</span>
<span class="lineNum">     465 </span><span class="lineCov">          1 :         fsquare(t1, t0);</span>
<span class="lineNum">     466 </span>            :     }
<span class="lineNum">     467 </span><span class="lineCov">          1 :     /* 2^100 - 2^0 */ fmul(z2_100_0, t1, z2_50_0);</span>
<span class="lineNum">     468 </span>            : 
<span class="lineNum">     469 </span><span class="lineCov">          1 :     /* 2^101 - 2^1 */ fsquare(t1, z2_100_0);</span>
<span class="lineNum">     470 </span><span class="lineCov">          1 :     /* 2^102 - 2^2 */ fsquare(t0, t1);</span>
<span class="lineNum">     471 </span><span class="lineCov">          1 :     /* 2^200 - 2^100 */ for (i = 2; i &lt; 100; i += 2) {</span>
<span class="lineNum">     472 </span><span class="lineCov">          1 :         fsquare(t1, t0);</span>
<span class="lineNum">     473 </span><span class="lineCov">          1 :         fsquare(t0, t1);</span>
<span class="lineNum">     474 </span>            :     }
<span class="lineNum">     475 </span><span class="lineCov">          1 :     /* 2^200 - 2^0 */ fmul(t1, t0, z2_100_0);</span>
<span class="lineNum">     476 </span>            : 
<span class="lineNum">     477 </span><span class="lineCov">          1 :     /* 2^201 - 2^1 */ fsquare(t0, t1);</span>
<span class="lineNum">     478 </span><span class="lineCov">          1 :     /* 2^202 - 2^2 */ fsquare(t1, t0);</span>
<span class="lineNum">     479 </span><span class="lineCov">          1 :     /* 2^250 - 2^50 */ for (i = 2; i &lt; 50; i += 2) {</span>
<span class="lineNum">     480 </span><span class="lineCov">          1 :         fsquare(t0, t1);</span>
<span class="lineNum">     481 </span><span class="lineCov">          1 :         fsquare(t1, t0);</span>
<span class="lineNum">     482 </span>            :     }
<span class="lineNum">     483 </span><span class="lineCov">          1 :     /* 2^250 - 2^0 */ fmul(t0, t1, z2_50_0);</span>
<span class="lineNum">     484 </span>            : 
<span class="lineNum">     485 </span><span class="lineCov">          1 :     /* 2^251 - 2^1 */ fsquare(t1, t0);</span>
<span class="lineNum">     486 </span><span class="lineCov">          1 :     /* 2^252 - 2^2 */ fsquare(t0, t1);</span>
<span class="lineNum">     487 </span><span class="lineCov">          1 :     /* 2^253 - 2^3 */ fsquare(t1, t0);</span>
<span class="lineNum">     488 </span><span class="lineCov">          1 :     /* 2^254 - 2^4 */ fsquare(t0, t1);</span>
<span class="lineNum">     489 </span><span class="lineCov">          1 :     /* 2^255 - 2^5 */ fsquare(t1, t0);</span>
<span class="lineNum">     490 </span><span class="lineCov">          1 :     /* 2^255 - 21 */ fmul(out, t1, z11);</span>
<span class="lineNum">     491 </span><span class="lineCov">          1 : }</span>
<a name="492"><span class="lineNum">     492 </span>            : </a>
<span class="lineNum">     493 </span>            : SECStatus
<span class="lineNum">     494 </span><span class="lineCov">          1 : ec_Curve25519_mul(uint8_t *mypublic, const uint8_t *secret,</span>
<span class="lineNum">     495 </span>            :                   const uint8_t *basepoint)
<span class="lineNum">     496 </span>            : {
<span class="lineNum">     497 </span>            :     felem bp[5], x[5], z[5], zmone[5];
<span class="lineNum">     498 </span>            :     uint8_t e[32];
<span class="lineNum">     499 </span>            :     int i;
<span class="lineNum">     500 </span>            : 
<span class="lineNum">     501 </span><span class="lineCov">          1 :     for (i = 0; i &lt; 32; ++i) {</span>
<span class="lineNum">     502 </span><span class="lineCov">          1 :         e[i] = secret[i];</span>
<span class="lineNum">     503 </span>            :     }
<span class="lineNum">     504 </span><span class="lineCov">          1 :     e[0] &amp;= 248;</span>
<span class="lineNum">     505 </span><span class="lineCov">          1 :     e[31] &amp;= 127;</span>
<span class="lineNum">     506 </span><span class="lineCov">          1 :     e[31] |= 64;</span>
<span class="lineNum">     507 </span><span class="lineCov">          1 :     fexpand(bp, basepoint);</span>
<span class="lineNum">     508 </span><span class="lineCov">          1 :     cmult(x, z, e, bp);</span>
<span class="lineNum">     509 </span><span class="lineCov">          1 :     crecip(zmone, z);</span>
<span class="lineNum">     510 </span><span class="lineCov">          1 :     fmul(z, x, zmone);</span>
<span class="lineNum">     511 </span><span class="lineCov">          1 :     fcontract(mypublic, z);</span>
<span class="lineNum">     512 </span>            : 
<span class="lineNum">     513 </span><span class="lineCov">          1 :     return 0;</span>
<span class="lineNum">     514 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.12</a></td></tr>
  </table>
  <br>

</body>
</html>
